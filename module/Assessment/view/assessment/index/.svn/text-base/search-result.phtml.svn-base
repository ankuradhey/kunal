<link href='<?php echo $this->cdn("/css/website/search.css"); ?>' rel='stylesheet' type="text/css">
<style type="text/css">
    .search-result-cont{
        margin: 30px 20px 20px 20px;
        font-family: 'open_sansregular';
        font-size: 13px;
        color: #000000;
        line-height: 1.4;
    }
    .search-result-cont h2{
        font-size: 21px;
        border-bottom: solid 1px #D6D6D6;
        padding: 0 0 5px 10px;
        margin: 0 0 20px 0;
    }
    .search-result-cont .search-table{
        display: table;
        width: 100%;
        border: 10px solid #E6E6E6;
        border-radius: 5px;
        box-shadow: 0 4px 4px -4px #000000;
        border-collapse: collapse;
        text-align: left;
        box-sizing: border-box;
        -moz-box-sizing: border-box;
        -webkit-box-sizing: border-box;
    }
    .search-result-cont .search-row{
        display: table-row;
    }
    .search-result-cont .search-row:first-child{
        background: #f6f6f6;
        color: #323232;
        font-size: 14px;
    }
    .search-result-cont .search-cell{
        display: table-cell;
        padding: 10px;
        border-right: 1px solid #e8e8e8;
        border-bottom: 1px solid #e8e8e8;
        box-sizing: border-box;
        -moz-box-sizing: border-box;
        -webkit-box-sizing: border-box;
    }
    .search-result-cont .search-cel:last-child{
        border-right:none;
    }
    .search-result-cont .search-cell:first-child,.search-result-cont .search-cell:last-child,.search-result-cont .search-cell:nth-child(3){
        text-align: center;
    }
    .search-result-cont .search-cell:first-child{
        /*max-width: 15px;*/
    }
    .search-result-cont .search-chap-view{
        text-decoration: none;
        padding: 0 0 0 20px;
        background: url('<?php echo $this->cdn() ?>/images/website/view-icon.png') no-repeat 0px 2px;
        display: inline-block;
        color: #000000;
    }
</style>
<?php $uri = $this->serverUrl(true); ?>
<div id="content" class="inner-content">
    <div class="container">
        <div class="row">
            <div class="search-page">
                <h2>Search Results</h2>
                <div class="table-responsive">
                    <?php if (count($this->searchResult) != 0) { ?>
                        <table class="table table-bordered">
                            <tr>
                                <th width='10%'>S No.</th>
                                <th>Subject</th>
                                <th>Board</th>
                                <th>Class</th>
                                <th>Chapter</th>
                                <th width='10%'>Action</th>
                            </tr>
                            <?php
                            //echo "<pre />"; print_r($this->searchResult); exit;
                            foreach ($this->searchResult as $key => $searchResult) {
                                ?>
                                <tr>
                                    <td><?php echo $key + 1; ?></td>
                                    <td><?php echo $searchResult['subject_name']; ?></td>
                                    <td>
                                        <?php
                                        if ($searchResult['board_name'] == 'K5') {
                                            $searchResult['board_name'] = 'CBSE';
                                            $searchResult['board_id'] = '2253';
                                        }
                                        ?>

                                        <?php echo $searchResult['board_name']; ?> 
                                    </td>
                                    <td class="search-cell"><?php echo $searchResult['class_name']; ?></td>
                                    <?php
                                    $chaptername = (@$searchResult['alt_chapter_name'] != '' ? $searchResult['alt_chapter_name'] : $searchResult['chapter_name']);
                                    $chapter_ids = (@$searchResult['alt_chapter_id'] != '' ? $searchResult['alt_chapter_id'] : $searchResult['rack_id']);
                                    ?>
                                    <td>
                                        <span class="<?php if (@$searchResult['chapter_language'] == 'Kruti Dev 010') { ?>hindi<?php } ?>"><?php echo html_entity_decode($chaptername); ?></span>
                                    </td>
                                    <td>
                                        <?php if ($this->zfcUserIdentity()) { ?>
                                            <a  id="various1" class="search-chap-view" href="javascript:void(0);" onclick="checkSubscribe('path', '<?php echo $key + 1; ?>')">View</a>
                                            <input type="hidden" id="subjectId<?php echo $key + 1; ?>" name="subjectId<?php echo $key + 1; ?>" value="<?php echo $searchResult['subject_id'] . '-' . $searchResult['class_id'] . '-' . $chapter_ids; ?>"/> 
                                        <?php } else { ?>
                                            <a id="various1" class="search-chap-view showmnu fancybox" id="various1" onclick="getPopupForms('login', '<?php echo $uri; ?>');" href="javascript:void(0);" >View</a>
                                        <?php } ?>
                                    </td>
                                </tr>
                                <?php
                            }
                            ?>
                        </table>
                        <?php
                    }else{
                    ?>
                     <table class="table table-bordered">
                      <tr>
                      <td> No Record Found.</td>
                    </tr>
                    </table>
                    <?php } ?>
                </div>
            </div>
        </div>
    </div>
</div>
<script type="text/javascript">
    $(document).ready(function() {
        $('#leftBar').height($('#in-container').height() - 9);



    });

    window.onbeforeunload = function() {
<?php
unset($_SESSION['user']['searchtext']);
?>
    }


    function checkSubscribe(path, value) {
        var subjectAndClassIds = $('#subjectId' + value).val();
        var ids = subjectAndClassIds.split('-');
        var subjectId = ids[0];
        var classId = ids[1];
        var chapterId = ids[2];
        var path = BASE_URL + "/website/index/dashboard/" + classId + "#/chapterDetails/" + chapterId;

        $.ajax({
            type: 'POST',
            url: BASE_URL + '/search-result/',
            data: {subjectId: subjectId, classId: classId},
            success: function(data) {
                if (data.output == 0) {
                    alert('You are not subscribed this subject');
                } else {
                    window.location = path;
                }
            }
        });
    }
</script>
