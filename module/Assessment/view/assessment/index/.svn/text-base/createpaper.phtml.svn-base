<link rel="stylesheet" href="<?php echo $this->basePath("css/website/profile.css"); ?>" type="text/css" media="screen" />
<?php if(isset($userObj) && $userObj!=''){ ?>
<script type="text/javascript">
    var fileerrorcounter = 0;
    var filemarkscounter = 0;
    var fileuploadcounter = 0;
    function checkFileExtension(filename, fileId)
    {
        
        var allowedExtension = ['jpeg', 'jpg', 'png', 'gif', 'pdf', 'txt', 'doc', 'ods', 'docx'];
        var fileExtension = filename.split('.').pop().toLowerCase();
       
        if ($.inArray(fileExtension, allowedExtension) == -1) {
           fileerrorcounter++;
            $('#'+fileId+'_error').css('display', 'inline');
            
        }
        else
        {
            if(fileerrorcounter != 0){ fileerrorcounter--; }
            $('#'+fileId+'_error').css('display', 'none');
            fileuploadcounter++;
            
        }
        
        if(fileerrorcounter == 0)
        {
            $('#create').attr('type', 'submit');
        }
        else
        {
            $('#create').attr('type', 'button');
        }
    }
    function deleteTotMarks(marks)
    {
            if(marks != '')
            {
                    var totMarks = $('#mentor_paper_marks').val();
                    if(totMarks != 0)
                    {
                        var newtotMarks = parseInt(parseInt(totMarks)-parseInt(marks));
                        $('#mentor_paper_marks').val('');
                        $('#mentor_paper_marks').val(parseInt(newtotMarks));  
                    }
            }
    }
    function validateMarks(marks, marksId)
    {
        if(!marks.match(/^\d+$/))
        {
            filemarkscounter++;
            //$('#'+marksId+'_error').css('display', 'inline');   
        }
        else
        {
            //if(filemarkscounter != 0){ filemarkscounter--; }
            //$('#'+marksId+'_error').css('display', 'none');
            var totalmarks = $('#mentor_paper_marks').val();
            var totalmarks = parseInt(parseInt(totalmarks)+parseInt(marks));
            $('#mentor_paper_marks').val(totalmarks); // for updating the paper marks
            
        }
        
        if(filemarkscounter == 0)
        {
            $('#create').attr('type', 'submit');
        }
        else
        {
            $('#create').attr('type', 'button');
        }
    }
    

$(document).ready(function() {
       
      // for checking the paper empty condition 
       $('#create').click(function(){
         sourceCheckVal = $('#sourcecheck').val();
         
         if(sourceCheckVal != 'upload')
         {
            var totalQuestion = $('div.ques_container').length; 
                if(totalQuestion == 0)
                {
                   alert('Please add questions in your paper.');
                   $('#create').attr('type', 'button'); 
                   return false;
                }
                else
                {
                     $('#create').attr('type', 'submit'); 
                }
         }
         else
         { 
             if(fileuploadcounter == 0)
                 {
                      alert('Please upload your question paper.');
                      $('#create').attr('type', 'button'); 
                      return false;
                 }
                 else
                 {
                     $('#create').attr('type', 'submit'); 
                 }
         }
       });
       $("#self_btn").click(function(){ 
            $('#sourcecheck').val('self');
            if($('#mentor_paper_marks').val() == 0 || $('#mentor_paper_marks').val() == '')
            {
                $('#mentor_paper_marks').val('0');
            }
            $('#preview').css('display', 'inline');
	    $("#questionArea").load('<?php echo $this->Url('selfquestions')?>');     
	});
	$("#lms_btn").click(function(){
            $('#quesloder').show();
            $('#sourcecheck').val('lms');
            
            if($('#mentor_paper_marks').val() == 0 || $('#mentor_paper_marks').val() == '')
            {
                $('#mentor_paper_marks').val('0');
            }
            var limit = 10; 
            $('#preview').css('display', 'inline');            
            $("#questionArea").load('<?php echo $this->Url('lmsquestions')?>/<?php echo $boardId; ?>/<?php echo $classId; ?>/<?php echo $subjectId; ?>/<?php echo $studentId; ?>', function() {
                    $('#quesloder').hide();
                });
	});
	$("#upload_btn").click(function(){
            $('#sourcecheck').val('upload');
            $('#mentor_paper_marks').val('0');
            $('#preview').css('display', 'none');
            $("#questionArea").load('<?php echo $this->Url('uploadquestions')?>');
	});
	
	// for checking the unique paper name
        $('#mentor_paper_name').blur(function(){
            var paperName = $('#mentor_paper_name').val();
            if(paperName != '')
            {
                $.ajax({
                        url: '<?php echo $this->Url('checkpapername')?>/<?php echo $classId; ?>/<?php echo $subjectId; ?>/'+paperName,
                        beforeSend: function() {


                        },
                        success: function(data) {
                             if(data == 'exists')   
                             {
                                 $('#papererror').css('display', 'inline');
                                 $('#create').attr('type', 'button');
                             }
                             else
                             {
                                 $('#papererror').css('display', 'none');
                                 $('#create').attr('type', 'submit');    
                             }
                       }
                 });
             }
        });
	
});
function previewpaper() {

	win = window.open('','myWin','toolbars=0, scrollbars=1');

       	document.createpaper.action='<?php echo $this->Url('previewpaper');?>';
        document.createpaper.target='myWin';
	document.createpaper.fullscreen='yes';
	document.createpaper.location='1';
	document.createpaper.scrollbars='yes';
	document.createpaper.submit();
	document.createpaper.action='';
	document.createpaper.target='_self';
   
} 

</script>
<?php 
$userpackageList=array();
$userpackageList=$this->UserPackage($studentId); 
?>
<div class="dashboard-content" id="content">
  <div class="dashboard-block">
    <div class="container">
      <div class="row" style="margin-top:20px;">
        <div class="myprofile-content">
          <div class="profile-view globle-click clearfix"> <strong>My Students</strong> <i class="icons-ar"></i> </div>
          <?php echo $this->partial('user/index/profile-menu.phtml',array('page'=>'my-students','addedStudents' => count($this->addedStudents)));?>
          <section class="profile-block">
          
          <input type="hidden" value="nav_5" id="nav_find">
                    <div class="right-content">
                    <div class="add-member clearfix">
                      <div class="editmentor_button"><a class="btn btn-primary" href="<?php echo $this->Url('mypaper');?>">My Tests</a></div>
                      <div class="editmentor_button"><a class="btn btn-primary" href="<?php echo $this->Url('my-students');?>">Back</a></div>
                    </div>
                      <div class="addChild_Container">
                            <h3>Create Papers</h3>
                            <div class="mentor-inner">
                      <form method="post" action="<?php echo $this->url('assessmenthome', array(), NULL, TRUE);?>" name="createpaper" id="createpaper" enctype="multipart/form-data">
                        <div class="mcq-view mcq-review">
                        <div class="mcq-svres-table">
                          <div class="sub-heading">
                            <div class="pull-right">Marks
                              <!-- <input name="marksadded" id="marksadded" type="text" value="0" class="marks first" />-->
                              <input name="mentor_paper_marks" id="mentor_paper_marks" type="text" value="0" class="marks" readonly />
                              <input name="sourcecheck" id="sourcecheck" type="hidden" value=""   />
                            </div>
                            <div style="clear:both;"></div>
                          </div>
                        </div>
                        <div class="singleview-res-cntr">
                        <div class="singleview-res-cntr-child">
                          <div class="singleview-res-cntr-left">
                            <ul class="create_paper_ul">
                              <li>
                                <label>Student Name</label>
                                <span class="width5">:</span><?php echo $studentName; ?></li>
                              <li>
                                <label>Class</label>
                                <span class="width5">:</span><?php echo $className; ?>
                                <input type="hidden" name="boardId" id="boardId" value="<?php echo $boardId; ?>" />
                                <input type="hidden" name="classId" id="classId" value="<?php echo $classId; ?>" />
                                <input type="hidden" name="className" id="className" value="<?php echo $className; ?>" />
                              </li>
                              <li>
                                <label>Subject</label>
                                <span class="width5">:</span><?php echo $subjectName; ?>
                                <input type="hidden" name="subjectId" id="subjectId" value="<?php echo $subjectId; ?>" />
                                <input type="hidden" name="subjectName" id="subjectName" value="<?php echo $subjectName; ?>" />
                              </li>
                              <li>
                                <label>Date</label>
                                <span class="width5">:</span><?php echo date('d-m-Y');?></li>
                              <li>
                                <label>Paper Name <span class="staricon">*</span></label>
                                <span class="width5">:</span>
                                <input type="text" class="inputfeild" name="mentor_paper_name" id="mentor_paper_name" required />
                                <span style="display:none; color:#D01F3C;" id="papererror">Paper name already exists.</span> </li>
                              <li>
                                <label>Instruction</label>
                                <span class="width5">:</span>
                                <textarea name="mentor_paper_instruction" class="inputfeild" id="mentor_paper_instruction"></textarea>
                              </li>
                              <li>
                                <label>Time</label>
                                <span class="width5">:</span>
                                <select name="mentor_paper_hour" id="mentor_paper_hour" style="width:150px">
                                  <?php for($a=0;$a<5; $a++)
                                        {
                                            if($a<10)
                                            {
                                                $a = '0'.$a;
                                            }
                                            ?>
                                  <option value="<?php echo $a; ?>"><?php echo $a; ?></option>
                                  <?php
                                        }
                                        ?>
                                </select>
                                hh
                                <select name="mentor_paper_minute" id="mentor_paper_minute" style="width:150px">
                                  <option value="00">00</option>
                                  <option value="15">15</option>
                                  <option value="30">30</option>
                                  <option value="45">45</option>
                                </select>
                                mm </li>
                              <li id="movedquestionarea" class="movedquestionareaclass" style="border-bottom:none;">
                                <input type="hidden" name="papersource" id="papersource" value="" />
                              </li>
                              <?php $nurseryArray = array('I', 'II', 'III', 'IV', 'V');?>
                              <li class="white-custom-tooltip">
                                <label>Question Source</label>
                                <span class="width5">:
                                <br>
                                </span> 1. <a href="javascript:void(0)" id="self_btn">Add Question</a>
                                <?php if(!in_array($className, $nurseryArray)){ ?>
                                /
                                <?php  if(in_array($subjectId,$userpackageList)) { ?>
                                <a href="javascript:void(0)" id="lms_btn" >Add Question From Extramarks Repository</a>
                                <?php } else { ?>
                                <a href="javascript:void(0)" style="text-decoration: none;opacity:0.5" data-placement="top" data-toggle="tooltip" data-original-title="This feature is not available as <?php echo $studentName; ?> has not subscribed for <?php echo $className; ?> - <?php echo $subjectName; ?> " >Add Question From Extramarks Repository</a>
                                <?php } ?>
                                <?php } ?>
                                <br>
                                <span style="margin-left:192px; display:inline-block; margin-top:10px;">2. <a href="javascript:void(0)" id="upload_btn">Upload</a> </span> </li>
                            </ul>
                            <div style="clear:both;"></div>
                            <div class="text-center" id="quesloder" style="padding: 20px; display: none;"><img src="<?php echo $this->cdn() ?>/images/website/loading.gif"></div>
                            <div id="questionArea"> </div>
                            <div class="clear">&nbsp;</div>
                            <div  style="text-align:center;">
                              <input type="button" class="btn btn-primary" name="preview" id="preview" value="Preview" onclick="previewpaper();" />
                              &nbsp; &nbsp;
                              <input type="submit" class="btn btn-primary" name="create" id="create" value="Create" />
                            </div>
                          </div>
                        </div>
                        <!--<?php //}?>-->
                        <div class="clear_spacer30">&nbsp;</div>
                      </form>
                    </div>
            </div>
            </div>
          </section>
        </div>
      </div>
    </div>
  </div>
</div>
<?php } else { ?>
<script>
		window.location="<? echo $this->url('home');?>"
               
	</script>
<?php } ?>