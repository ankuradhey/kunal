<link rel="stylesheet" href="<?php echo $this->basePath("css/website/profile.css"); ?>" type="text/css" media="screen" />
<!-- <link rel="stylesheet" href="<?php echo $this->basePath("css/website/sortable/jq.css"); ?>" type="text/css" media="screen" />
<link rel="stylesheet" href="<?php echo $this->basePath("css/website/sortable/theme.default.css"); ?>" type="text/css" media="screen" /> -->
<script type="text/javascript" src="<?php echo $this->basePath("js/website/jquery.tablesorter.js"); ?>"></script>
<script type="text/javascript" src="<?php echo $this->basePath("js/website/jquery.tablesorter.widgets.js"); ?>"></script>
<style type="text/css">
    .errorfrm_mymentor{height: 15px;}
    .register_overlay{ background: #000; opacity:0.5; position: fixed; top: 0; left: 0; width: 100%; z-index: 1000; height: 100%}
    .seen {display:block !important;}
    .highlight{opacity:0.4;}
    .package-details .table-striped > tbody > tr{ }
    .package-details .table-striped > tbody > tr > td{ border-top:none; color: #222;}
    .label_link{margin-bottom: 5px;}
</style>

<?php if ($this->zfcUserIdentity()) { ?>
    <div id="content" class="profile-pages">
        <div class="container">
            <div class="row">
                <div class="myprofile-content">
                    <div class="profile-view globle-click clearfix">
                        <strong>My Students</strong>
                        <i class="icons-ar"></i>	
                    </div>
                    <?php
                    echo $this->partial('user/index/profile-menu.phtml', array('page' => 'myStudents', 'addedmentors' => count($this->addedMentors), 'addedStudents' => count($addedStudents)));
                    ?>
                    <section class="profile-block">
                        <input type="hidden" value="nav_5" id="nav_find">
                        <div class="add-member clearfix">
                            <a id="add-mentor-tog" href="javascript:void(0)"><i class="icons-plus img-circle"></i> Add Student</a>
                            <div class="editmentor_button">
                                <a href="<?php echo $this->Url('mypaper'); ?>" class="btn btn-primary"> My Tests</a>	
                            </div>	
                        </div>
                        <div class="form-block addmentor-form">
                            <form id="user-my-mentor_form" method="post" class="form-horizontal">
                                <input type="hidden" name="requestInitiator" id="requestInitiator" value="yes" />
                                <span class="errorfrm_mentor" id="succussesMessageload"></span>
                                <div class="errorfrm_mymentor" id="errorRelationship">&nbsp;</div>
                                <div class="form-group">
                                    <label for="name" class="col-sm-2 control-label">Name<sup>*</sup></label>
                                    <div class="col-xs-12 col-sm-10">
                                        <div class="col-xs-3 col-sm-2 mentor-select">
                                            <select name="gender" class="select">
                                                <option value="mr">Mr.</option>
                                                <option value="ms">Ms.</option>
                                            </select>
                                        </div>	
                                        <div class="col-xs-9 col-sm-5 h-width">	
                                            <input id="Student_Name"  type="text" name="Student_Name"  type="text" class="form-control" placeholder="Please enter student name"/>
                                        </div>
                                        <div class="errorfrm_mymentor" id="errorStudent_Name">&nbsp;</div>
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label for="inputEmail4" class="col-sm-2 control-label">Email<sup>*</sup></label>
                                    <div class="col-sm-5 f-width">	
                                        <input  name="Student_Email" type="email" class="form-control" id="Student_Email" placeholder="Please enter student email address">
                                        <div class="errorfrm_mymentor" id="erroremail">&nbsp;</div>
                                    </div>
                                    <span style="display:none" id="emailLoaddrop"><img src="<?php echo $this->cdn() ?>/images/website/loader16.gif"></span>
                                </div>
                                <input type="hidden" id="Student_phone_id" name="Student_phone_id" value="">
                                
                                <div class="form-group">
                                    <label for="inputEmail4" class="col-sm-2 control-label">Board<sup>*</sup></label>
                                    <div class="col-sm-5 f-width">	
                                        <select  name="board_id" id="board_id" class="select">
                                            <option value="0">Select a board </option>
                                            <?php
                                            if (count($this->boards)) {
                                                foreach ($this->boards as $key=>$boards) {
                                                    ?>
                                                    <option value="<?php echo $boards[0]['customBoard']['customBoardId'] ?>"><?php echo $boards[0]['customBoard']['boardName'] ?></option>
                                                    <?php
                                                }
                                            }
                                            ?>
                                        </select>
                                        <div class="errorfrm_mymentor" id="errormentorBoard">&nbsp;</div>
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label for="inputEmail4" class="col-sm-2 control-label">Class<sup>*</sup></label>
                                    <div class="col-sm-5 f-width" id="selectedClass">	
                                        <select class="select" name="class_id" id="class_id">
                                            <option selected="selected" value="0">Select a Class</option>
                                            
                                        </select>
                                         <div class="errorfrm_mymentor" id="errormentorClass">&nbsp;</div>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="inputEmail4" class="col-sm-2 control-label">Subject<sup>*</sup></label>
                                    <div class="col-sm-5 f-width">	
                                        <select class="form-control" name="student_subject" id="mentor_subject" multiple>
                                            <option value="" selected>Select a subject</option>
                                            <?php
                                            if (count($this->subjectdetails) != 0) {
                                                foreach ($this->subjectdetails as $subjectdetails) {
                                                    ?>									
                                                    <option value="<?php echo $subjectdetails->board_class_subject_id; ?>"><? echo $subjectdetails->subject_name; ?></option>
                                                    <?php
                                                }
                                            }
                                            ?>
                                        </select>
                                         <span class="errorfrm_mymentor" id="errormentorSubject">&nbsp;</span>
                                    </div>
                                </div>
                               
                               
                                <span class="errorfrm_mymentor" id="errorsameemailid">&nbsp;</span> 
                                <div class="errorfrm_mymentor" id="succussesMessage"></div>
                                <div class="form-group">
                                    <label for="inputEmail4" class="col-sm-2 control-label hidden-xs">&nbsp;</label>
                                    <div class="col-sm-5">	
                                        <button onclick="return submitForm()" id="submitemail" class="btn btn-primary" type="button">SUBMIT</button>
                                        <button class="btn cancel-btn" type="submit">CANCEL</button>
                                        <span style="display:none;" id="loadding"><img src="<?php echo $this->cdn() ?>/images/website/loader16.gif"></span>
                                    </div>
                                </div>
                                <?php
                                if (count($this->mentorssIds) != 0) {
                                    foreach ($this->mentorssIds as $key => $mentorssIds) {
                                        ?>
                                        <input type="hidden" id="<?php echo str_replace(' ', '', $key) ?>" name="<?php echo str_replace(' ', '', $key) ?>" value="<?php echo $mentorssIds ?>">
                                        <?php
                                    }
                                }
                                ?>
                            </form>
                            <span style="display:none;" id="loadding1"><img src="<?php echo $this->cdn() ?>/images/website/loader16.gif"></span>
                        </div>
                        <div class="addChild_Container">
                            <h3>My Students</h3>
                            <div class="mentor-inner myStudent common_table" id="mentorsTable">
                             <div class="table-responsive">	
                                <?php
                                if (isset($this->addedStudents) && count($this->addedStudents) != 0) {
                                    ?>
                                    <table class="table table-bordered tablesorter" id="mentors-Table">
                                        
                                            <thead>
                                        <tr>
                                            <th>Action</th>
                                            <th>Name <i></i></th>
                                            <th>Board <i></i></th>
                                            <th>Class <i></i></th>
                                            <th>Subject <i></i></th>
                                            <th>No of Tests Taken <i></i></th>
                                            <th>Current Score in % <i></i></th>
                                            <th>Date Of Joining <i></i></th>
                                            <!--th>Action <i></i></th--> 
                                        </tr>
                                        </thead>
                                        <tbody>
                                        <?php
                                        //echo '<pre>'; print_r($this->addedStudents); exit;
                                        foreach ($this->addedStudents as $key => $addedStudents) {
                                            //echo '<pre>'; print_r($addedStudents); exit;
                                            $subject_id = $addedStudents->subject_id;
                                            $student_id = $addedStudents->student_id;
                                            //echo $subject_id;
                                            //echo '<pre>'; print_r($this->percentageArr); exit;
                                            if (1) {
                                                ?>
                                            <?php $redPer = false;
                                                if(isset($this->percentageArr[$student_id.'-'.$subject_id])) {
                                                  $percentage = $this->percentageArr[$student_id.'-'.$subject_id]['percentage'];
                                                  $testTaken = $this->percentageArr[$student_id.'-'.$subject_id]['testTaken'];
                                                  if($percentage < 60 && $testTaken != 0){
                                                        $redPer = true;
                                                  }
                                                } ?>
                                                <?php $attemptedTestCount=0;
                                                if(isset($this->total_attempts[$student_id.'-'.$subject_id])) {
                                                  $testTaken = $this->total_attempts[$student_id.'-'.$subject_id];
                                                  if($testTaken==0){
                                                    //echo 'N/A';  
                                                  } else {
                                                      $attemptedTestCount++;
                                                      //echo $testTaken;
                                                  }
                                                } else {
                                                  //echo 'N/A';  
                                                } 
                                                //echo '<pre>'; print_r($addedStudents); exit;
                                                ?>
                                                <tr class="data-row" id="student_<?php echo $addedStudents->id ?>">
                                                <input type="hidden" id="namestudent<?php echo $addedStudents->id ?>" name="namestudent<?php echo $addedStudents->id ?>" value="<?php echo $addedStudents->display_name ?>">
                                                <input type="hidden" id="studentId<?php echo $addedStudents->id ?>" name="studentId<?php echo $addedStudents->id ?>" value="<?php echo $addedStudents->student_id ?>">
                                                <input type="hidden" id="boardId<?php echo $addedStudents->id; ?>" name="boardId<?php echo $addedStudents->id ?>" value="<?php echo $addedStudents->board_ids; ?>">
                                                <input type="hidden" id="classId<?php echo $addedStudents->id ?>" name="classId<?php echo $addedStudents->id ?>" value="<?php echo $addedStudents->board_class_id; ?>">
                                                <input type="hidden" id="boardName<?php echo $addedStudents->id ?>" name="boardName<?php echo $addedStudents->id ?>" value="<?php echo $addedStudents->board_name; ?>">
                                                <input type="hidden" id="className<?php echo $addedStudents->id ?>" name="className<?php echo $addedStudents->id ?>" value="<?php echo $addedStudents->class_name ?>">
                                                <input type="hidden" id="subjectId<?php echo $addedStudents->id ?>" name="subjectId<?php echo $addedStudents->id ?>" value="<?php echo $addedStudents->subject_id ?>">
                                                <!--td><?//php echo $key + 1 ?></td-->
                                                <td>&nbsp;
                                                    <!--i class="icons-plus img-circle" style="font-size:18px;"></i-->
                                                    <?php if($addedStudents->subject_id == ''){ ?>
                                                    <span>
                                                        <a id="addsubjectforlearner" onclick="addsubjecttolearner('<?php echo $addedStudents->id; ?>','<?php echo $addedStudents->board_ids; ?>','<?php echo $addedStudents->class_id; ?>','<?php echo $addedStudents->board_name; ?>','<?php echo $addedStudents->class_name; ?>')" href="javascript:void(0)">Add Subject</a>
                                                    </span>
                                                    <?php }else{ ?>
                                                        <?php $action_names = '';?>
                                                        <?php if ($addedStudents->status == 0) { ?>
                                                            <!--span class="status-red">
                                                                <?php if ($addedStudents->request_initiator != $this->zfcUserIdentity()->getId()) { ?>
                                                                    <?php $action_names .= 'accept-';?>
                                                                    <a href="javascript:void(0)"  onclick="studentOperations('<?php echo $addedStudents->id ?>', 'active',<?php echo $addedStudents->student_id ?>, 'request', 'Mentor')" class="remove-link" title="Accept">Accept</a> / 
                                                                <?php } ?>
                                                                <a href="javascript:void(0)"  onclick="studentOperations('<?php echo $addedStudents->id ?>', 'delete',<?php echo $addedStudents->student_id ?>, 'request', 'Mentor')" class="remove-link" title="Decline">Decline</a> 
                                                            </span-->
                                                            <?php $action_names .= 'decline';?>
                                                            <span aria-hidden="true" title="<?php if($action_names=='decline'){ ?>Delete<?php } else { ?>Accept / Delete<?php } ?>" class="glyphicon glyphicon-plus-sign moreaction" style="font-size:18px;color:red;cursor:pointer;"></span>
                                                        <?php } else { ?>
                                                            <!--span class="status-green"><a href="javascript:void(0)"  onclick="addAssement('<?php echo $addedStudents->id ?>')" class="remove-link" >Add&nbsp;Assessment</a>&nbsp;/&nbsp;
                                                            <a href="javascript:void(0)"  onclick="studentOperations('<?php echo $addedStudents->id ?>', 'delete',<?php echo $addedStudents->student_id ?>, 'relation', 'Mentor')" class="remove-link">Delete</a>
                                                            </span-->
                                                            <?php $action_names .= 'addassessment-delete';?>
                                                            <span aria-hidden="true" title="Add Assessment / Delete / Feedback" class="glyphicon glyphicon-plus-sign moreaction" style="font-size:18px;color:green;cursor:pointer;"></span>
                                                        <?php } ?>
                                                    <?php } ?>
                                                        <input type="hidden" name="feedback-data" class="feedback-data" value="<?php echo $addedStudents->status ?>#'<?php echo str_replace(' ', '', $addedStudents->name) . "-" . $addedStudents->student_id . '-' . rtrim($addedStudents->board_name,'.') . '-' . $addedStudents->board_ids . '-' . $addedStudents->class_name . '-' . $addedStudents->class_ids . '-' . $this->subjectArray[$addedStudents->id]['subjectId']; ?>'#<?php echo $key ?>">
                                                        <input type="hidden" name="action-name" class="action-name" value="<?php echo $action_names;?>">
                                                        <input type="hidden" name="perform-action" class="perform-action" value="<?php echo $addedStudents->id.'-'.$addedStudents->student_id; ?>">
                                                </td>
                                                
                                                <td><a href="javascript:void(0)" <?php if($redPer==true && $attemptedTestCount !=0){?>style="color:red;"<?php }?> onclick="getPopupForms('userpopup','<?php echo $addedStudents->student_id; ?>','<?php echo $addedStudents->board_name; ?>','<?php echo $addedStudents->class_name; ?>');"><?php echo $addedStudents->name ?></a></td>
                                                 <!--<td><a href="javascript:void(0)" ><?php //echo $addedStudents->name               ?></a></td>-->
                                                <td><?php echo $addedStudents->board_name; ?></td>
                                                <td><?php echo $addedStudents->class_name;?></td>
                                                <td><?php echo $addedStudents->subject_name; ?></td>
                                                <td><?php $testCount=0;
                                                if(isset($this->total_attempts[$student_id.'-'.$subject_id])) {
                                                  $testTaken = $this->total_attempts[$student_id.'-'.$subject_id];
                                                  if($testTaken==0){
                                                    echo 'N/A';  
                                                  } else {
                                                      $testCount++;
                                                    if($action_names=='addassessment-delete'){  ?><a target="_blank" href="<?php echo $this->basePath().'/report/index/test-history/'.$addedStudents->student_id.'/'.$addedStudents->subject_id;?>"><?php } echo $testTaken; if($action_names=='addassessment-delete'){ ?></a><?php }
                                                  }
                                                } else {
                                                  echo 'N/A';  
                                                } ?></td>
                                                <td>
                                                <?php 
                                                if(isset($this->percentageArr[$student_id.'-'.$subject_id])) {
                                                  $percentage = $this->percentageArr[$student_id.'-'.$subject_id]['percentage'];
                                                  //$realPercentage = 100 - $percentage;
                                                  $testTaken = $this->percentageArr[$student_id.'-'.$subject_id]['testTaken'];
                                                  
                                                  if(!empty($percentage) && $attemptedTestCount != 0) {
                                                    if($action_names=='addassessment-delete'){  ?><a target="_blank" href="<?php echo $this->basePath().'/report/index/test-history/'.$addedStudents->student_id.'/'.$addedStudents->subject_id;?>"><?php } echo round($percentage, 2).' %'; if($action_names=='addassessment-delete'){ ?></a><?php }
                                                  } else {
                                                      if($testTaken > 0) {
                                                        //echo '0%';
                                                        if($action_names=='addassessment-delete'){  ?><a target="_blank" href="<?php echo $this->basePath().'/report/index/test-history/'.$addedStudents->student_id.'/'.$addedStudents->subject_id;?>"><?php } echo '0%'; if($action_names=='addassessment-delete'){ ?></a><?php }
                                                      } else {
                                                        echo 'N/A';
                                                      }
                                                  }
                                                } else {  
                                                      if($testTaken > 0) {
                                                        if($action_names=='addassessment-delete'){  ?><a target="_blank" href="<?php echo $this->basePath().'/report/index/test-history/'.$addedStudents->student_id.'/'.$addedStudents->subject_id;?>"><?php } echo '0%'; if($action_names=='addassessment-delete'){ ?></a><?php }
                                                      } else {
                                                        echo 'N/A';
                                                      }
                                                } ?>
                                                </td>
                                                <td><?php echo date('Y-m-d',strtotime($addedStudents->joining_date)); ?></td>
                                                
                                                <!--<td id="#<?php echo "mobile" . $key ?>" class="view_details"><img onclick="showPopupData('<?php echo $key ?>')" src="<?php echo $this->cdn() ?>/images/view_details.png" width="30px"/></td>-->
                                                </tr>
                                                
                                                <tr class=" package-details" style="display:none;" id="orderDetailes<?php echo $key;  ?>">
                                                    <td colspan="10" style="background: #f7f1ce;"></td>
                                                </tr> 

                                                <input type="hidden" id="checkStatus<?php echo $addedStudents->id ?>" name="checkStatus<?php echo $addedStudents->id ?>" value="<?php echo $addedStudents->status ?>">
                                                <?php
                                            }
                                        }
                                        ?>
                                        <script>
                                            function closedata()
                                            {
                                                $(".datashow_popup").hide();
                                                $(".backbase_transform").hide();
                                                $("#close_button").hide();
                                            }
                                            function showPopupData(key)
                                            {
                                                var firstname = $("#data-row-" + key + "-3").html();
                                                var board_name = $("#data-row-" + key + "-4").html();
                                                var subject_name = $("#data-row-" + key + "-5").html();
                                                var email_id = $("#data-row-" + key + "-6").html();
                                                var status = $("#data-row-" + key + "-7").html();
                                                var data = "<a id='close_button' onclick='closedata()' href='JavaScript:void(0)'></a><div class='datapopup_class'>" + firstname + "</div><div class='datapopup_class'>" + board_name + "</div><div class='datapopup_class'>" + subject_name + "</div><div class='datapopup_class'>" + email_id + "</div><div class='datapopup_class'>" + status + "</div>";
                                                $(".datashow_popup").html(data).show();
                                                $(".backbase_transform").show();
                                                $("#close_button").show();
                                            }
                                            $('.moreaction').click(function() {
                                               var id=$(this).parent().parent().attr('id');
                                               var action_names    = $(this).parent().find('.action-name').val(); 
                                               var perform_actions = $(this).parent().find('.perform-action').val();
                                               var feedback_data   = $(this).parent().find('.feedback-data').val();
                                               var feedbackDataArr = feedback_data.split("#");
                                               
                                               //var feedbackDataArrString = feedbackDataArr[1]+'';
                                               //var feedbackDataArrStr = feedbackDataArrString.split(' ').join('_');
                                               var feed_detail     = feedbackDataArr[1].split("-");
                                               var class_id        = feed_detail[5];
                                               var board_id = feed_detail[3];
                                               var actionNamesArr = action_names.split("-");
                                               var className = feed_detail[4];
                                               if(className=='Pre Primary (Nur + KG)') {
                                                   feedbackDataArr[1] = feedbackDataArr[1].replace('Pre Primary (Nur + KG)','Pre_Primary');
                                               } else if(className=='Lower Primary (I + II )') {
                                                   feedbackDataArr[1] = feedbackDataArr[1].replace('Lower Primary (I + II )','Lower_Primary');
                                               }
                                               var parformActionsArr = perform_actions.split("-");
                                               //alert(feedbackDataArr[1]);
                                               var html='';
                                               var new_feed_detail = feed_detail.reverse();
                                               var subject_id = "'"+new_feed_detail[0];
                                               if(board_id==''){
                                                   board_id=124;
                                               }
                                               html +='<table class="table table-striped"><tr><span style="display:none;" id="loaddingaction"><img src="<?php echo $this->cdn(); ?>/images/website/loader16.gif"></span>';
                                               if(action_names == 'addassessment-delete') {
                                                   //Student’s Queries
                                                   var deleteStr = parformActionsArr[0]+",'delete',"+parformActionsArr[1]+",'relation','Mentor'";
                                                   html +='<td><input type="radio" id="view-progress'+id+'" name="common-action" onclick="viewprogress('+parformActionsArr[1]+','+class_id+','+subject_id+','+board_id+')" class="remove-link common-action"><label class="label_link" for="view-progress'+id+'"> View Progress</label></td>';
                                                   var type = "'Query'"; 
                                                   html +='<td><input type="radio" id="query'+id+'" name="common-action" onclick="checkStatus('+feedbackDataArr[0]+','+feedbackDataArr[1]+','+type+')" class="remove-link common-action"><label class="label_link" for="query'+id+'"> Student’s Queries</label></td>';
                                                   var feedback = "'Feedback'"; 
                                                    html +='<td><input type="radio" id="feedback'+id+'" name="common-action" onclick="checkStatus('+feedbackDataArr[0]+','+feedbackDataArr[1]+','+feedback+')" class="remove-link common-action"><label class="label_link" for="feedback'+id+'"> Feedback</label></td>';
                                                   var type = "'Upload'"; 
                                                   html +='<td><input type="radio" id="upload'+id+'" name="common-action" onclick="checkStatus('+feedbackDataArr[0]+','+feedbackDataArr[1]+','+type+')" class="remove-link common-action"><label class="label_link" for="upload-file'+id+'"> Upload File</label></td>';
                                                   var type = "'Download'"; 
                                                   html +='<td><input type="radio" id="download-file'+id+'" name="common-action" onclick="checkStatus('+feedbackDataArr[0]+','+feedbackDataArr[1]+','+type+')" class="remove-link common-action"><label class="label_link" for="download-file'+id+'"> Download File</label></td>';
                                                   html +='<td><input type="radio" id="assessment'+id+'" name="common-action" onclick="addAssement('+parformActionsArr[0]+')" class="remove-link common-action"><label class="label_link" for="assessment'+id+'"> Assessment</label></td>';
                                                   html +='<td><input type="radio" id="delete'+id+'" name="common-action" onclick="studentOperations('+deleteStr+')" class="remove-link common-action"><label class="label_link" for="delete'+id+'"> Delete</label></td>';
                                               } else if(action_names == 'accept-decline'){
                                                   var activeStr = parformActionsArr[0]+",'active',"+parformActionsArr[1]+",'request','Mentor'";
                                                   var deleteStr = parformActionsArr[0]+",'delete',"+parformActionsArr[1]+",'request','Mentor'";
                                                   html += '<td><input type="radio" id="accept'+id+'" name="common-action" onclick="studentOperations('+activeStr+')" class="remove-link common-action"><label class="label_link" for="accept'+id+'"> Accept</label></td>';
                                                   html += '<td><input type="radio" id="delete'+id+'" name="common-action" onclick="studentOperations('+deleteStr+')" class="remove-link common-action"><label class="label_link" for="delete'+id+'"> Delete</label></td>';
                                               } else if(action_names == 'decline') {
                                                   var deleteStr = parformActionsArr[0]+",'delete',"+parformActionsArr[1]+",'request','Mentor'";
                                                   html += '<td><input type="radio" id="delete'+id+'" name="common-action" onclick="studentOperations('+deleteStr+')" class="remove-link common-action"><label class="label_link" for="delete'+id+'"> Delete</label></td>';
                                               }
                                               if(action_names == 'addassessment-delete') {
                                               }
                                               html +='</tr></table>';
 
                                             //  $('.package-details').hide();
                                           if($(this).hasClass('glyphicon-plus-sign')){
                                               $('#mentors-Table > tbody tr').addClass("highlight");
                                               $('.package-details').removeClass("highlight");
                                               $('#'+id).css('background-color','');
                                               $('#'+id).removeClass("highlight");
                                               $(".package-details").hide();
                                               
                                              
                                               $('#orderDetailes'+feedbackDataArr[2]).toggle();
                                               $(this).removeClass("glyphicon-plus-sign");
                                               $(this).addClass('glyphicon-minus-sign');
                                               
                                              $('#'+id).css('background-color','#f7f1ce');
                                               // $(this).parent().css('background-color','#f7f1ce');
                                                $('#orderDetailes'+feedbackDataArr[2]).html('<td colspan="9" style="background: #f7f1ce;">' + html + '</td>');
                                            }else{
                                                $('#mentors-Table > tbody tr').removeClass("highlight");
                                               $('#orderDetailes'+feedbackDataArr[2]).toggle();
                                               $(this).removeClass('glyphicon-minus-sign');
                                               $("#student_"+feed_detail[1]).css('');
                                               $(this).addClass("glyphicon-plus-sign");
                                               $('#'+id).css('background-color','');
                                               $('#orderDetailes'+feedbackDataArr[2]).html('<td colspan="9" style="background: #f7f1ce;">' + html + '</td>');
                                           }
                                      });
                                     function getPopupForms(type, id) {
                                                var urlPath = '';
                                                if (type == 'userpopup') {
                                                    $("#overlay_logins").show();
                                                    $("#login_banner").hide();
                                                    $("#register_banner").hide();
                                                    $("#forgot_banner").hide();
                                                    $('#userprofile').show();
                                                    var userId = id;
                                                    baseURL = '<?php echo $this->url('userprofile'); ?>';
                                                    urlPath = baseURL + '?id=' + userId;
                                                }
                                                $.ajax({
                                                    type: 'POST',
                                                    url: urlPath,
                                                    data: 'user_type=students', 
                                                    success: function(data) {
                                                          if (type == 'userpopup') {
                                                            $('#model_body').html(data);
                                                            $('#userprofile').modal('show');    
                                                           }
                                                    }
                                                });
                                            }
                                        </script>
                                        </tbody>
                                    </table>
                                    <?php
                                } else {
                                    ?>
                                    <div class="no-record"><p>There are no students</p></div>

                                    <?php
                                }
                                ?>
                            </div>
                            </div>
                            <script id="js">
                            $('table').tablesorter({
                                    widgets        : ['zebra', 'columns'],
                                    usNumberFormat : false,
                                    sortReset      : true,
                                    sortRestart    : true
                            });
                            </script>
                            </head>
                        </div>
                    </section>
                </div>
            </div>
        </div>
    </div>

<div class="register_overlay" style="display:none;"></div>
<div class="modal custom-lightbox addchild-popup" id="add_learner_subject_popup" style="display:none;">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title" id="exampleModalLabel"> Add Subject
        </h4>
      </div>
    <div class="modal-body">
 <form class="form-horizontal">
  <div class="form-group successMessage">
      <input type="hidden" name="student_mentor_id" id="student_mentor_id" />
    <label for="inputEmail3" class="col-sm-2 control-label" style="padding-top: 0px;">Board</label>
    <div class="col-sm-10 padd-right" id="invited_learner_board">
        
    </div>
  </div>
  <div class="form-group successMessage">
    <label for="inputEmail3" class="col-sm-2 control-label" style="padding-top: 0px;">Class</label>
    <div class="col-sm-10 padd-right" id="invited_learner_class">
        
    </div>
  </div>
  <div class="form-group successMessage">
    <label for="inputEmail3" class="col-sm-2 control-label" style="padding-top: 0px;">Subject<sup>*</sup></label>
    <div class="col-sm-10 padd-right">
        <select class="form-control" name="invited_learner_subject" id="invited_learner_subject" multiple>
            <option value="" selected>Select a subject</option>
        </select>
        <span class="errorfrm_mymentor" id="errorinvitedlearnerSubject">&nbsp;</span>
    </div>
  </div>
   
  <div class="form-group clearfix successMessage" style="text-align:right;">
      <button type="button" class="btn btn-warning" onclick="closeinvitelearnerdiv();" data-toggle="modal" data-whatever="@mdo" style="float: right; margin-right: 15px;">Cancel</button>
      <button style="float: right; margin-right: 15px;" type="button" class="btn btn-warning" onclick="submitInvitedLearnerSubject();" data-toggle="modal" data-whatever="@mdo">Submit</button>
  </div>

  </form>
        <span style="display:none;" id="loadding_add_subject"><img src="<?php echo $this->cdn() ?>/images/website/loader16.gif"></span>
      </div>
    </div>
  </div>
</div>

<div class="modal fade  feedback-Popup" id="actionModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          <h4 class="modal-title" id="myModalLabel">Action Points</h4>
        </div>
        
        <div class="modal-body">
            
        </div>
    </div>
  </div>
</div>

<div class="modal fade addchild-popup userprofile-popup" id="userprofile" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
        <div class="clearfix"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div>
        <div class="modal-body" id="model_body">
        </div>
    </div>
  </div>
</div>
<?php } else { ?>
    <script>
        window.location = "<?php echo $this->url('home'); ?>"
    </script>
<?php } ?>

<link rel="stylesheet" href="http://code.jquery.com/ui/1.10.3/themes/smoothness/jquery-ui.css">
<script src="http://code.jquery.com/ui/1.10.3/jquery-ui.js"></script>
<style type="text/css">
    #user-my-mentor_form .select-wrappers select{height:36px;}
    #user-my-mentor_form .select-wrappers .holders{margin-top:-35px;}
</style>
<script type="text/javascript">

        $(document).ready(function() {
        	$('.select').selectbox();
            $("#profile").height($(".right-content").height() + 7);

            $("#board_id").change(function() {

                $("#class_id").parent().find(".holders").text("");
                $("#class_id").parent().find(".holders").text("Select a class");
                // $("#class_id").html('<option selected="" value="">Select Subject</option>');
                var classid = $("#board_id option:selected").val();
                //$("#mentor_subject").html('');
                $("#mentor_subject").html('<option selected="" value="">Select Subject</option>');

                
                $.ajax({
                    type: 'POST',
                    url: 'lms/index/custom-containerlist/' + $(this).val(),
                    dataType: 'json',
                    success: function(data) {

                        var classEle = $("#class_id");
                         var html = '';
                        if (data != '') {

                            html += '<select id="class_id" name="class_id" class="select"><option selected="" value="">Select Class</option>';
                            $.each(data.options, function(i, el) {
                               html += '<option value="'+el.rack_id+'">'+el.rack_name+'</option>';

                            });
                            html+='</select>';
                            $('#selectedClass').html(html).promise().done(function(){ 
                            $('#class_id').selectbox({
                               onChange:function(val,inst){
                                    $.ajax({
                                        type: 'POST',
                                        url: 'lms/index/containerlist/' + val,
                                        dataType: 'json',
                                        success: function(data) {
                                            if (data != ''){
                                                $("#mentor_subject").html('<option selected="" value="">Select Subject</option>');
                                                $.each(data.options, function(i, el) {
                                                $("#mentor_subject").append($("<option>").attr("value", el.rack_id).text(el.rack_name));
                                            });
                                            }else{
                                                   $("#mentor_subject").html('<option selected="" value="">Select Subject</option>');
                                                }
                                            }
                                     });
                                  }
                              });
                       
                          }); 
                            
                            //                        classEle.html(data);
                        } else {
                            classEle.html('<option selected="" value="">Select Class</option>');
                        }

                    }
                });
            });

//            $("#class_id").change(function() {
//                $.ajax({
//                    type: 'POST',
//                    url: 'lms/index/containerlist/' + $(this).val(),
//                    dataType: 'json',
//                    success: function(data) {
//
//                        if (data != '') {
//                            $("#mentor_subject").html('<option selected="" value="">Select Subject</option>');
//                            $.each(data.options, function(i, el) {
//                                $("#mentor_subject").append($("<option>").attr("value", el.rack_id).text(el.rack_name));
//
//                            });
//                            //                        $("#mentor_subject").append(data);
//                        } else {
//                            $("#mentor_subject").html('<option selected="" value="">Select Subject</option>');
//                        }
//
//
//                    }
//                });
//            });



        });
        $(window).resize(function() {
            $("#profile").height($(".right-content").height() + 7);
        });
</script>
<script type="text/javascript">
    //$(".inputs select").msDropDown();
    
    $(document).ready(function() {
        $("#profile").height($(".right-content").height() + 8);
    });
    $(window).resize(function() {
        $("#profile").height($(".right-content").height() + 8);
    });
</script>
<script type="text/javascript" language="JavaScript">
    $(document).ready(function() {
        document.forms['user-my-mentor_form'].elements['Student_Name'].focus();

    });
</script>
<script>
    function addAssement(studentId)
    {
        //var student_id = "";
        //var checkboxes=document.getElementsByTagName("INPUT");
        //var len=checkboxes.length;

        /*for(var i=0;i<len;i++)
         {
         if(checkboxes[i].type=="checkbox")
         {
         if(checkboxes[i].checked)
         {
         student_id+=checkboxes[i].value+',';
         cnt++;
                 
         }
         }
         }*/
        var cnt = 1;
        selectBoxes = studentId;
        if (cnt == 0)
        {
            alert("Please select atleast one student");
            return false;
        } else if (cnt == 1)
        {
            //studentId = selectBoxes.replace(/,\s*$/, "");
            //var curstudentId = $("#studentId" + studentId).val();

            window.location = BASE_URL + '/assessmenthome/' + studentId;
        }
        else if (cnt > 1)
        {
            alert("Please select only one student");
            return false;
        }
    }
    function viewprogress(student_id,class_id,subject_id,board_id)
    {
        $.ajax({type: 'POST',
                url: BASE_URL + "/lms/index/custom-containerlist/"+board_id,
                dataType: 'json',
                success: function(data) {
                   var optionString = '<option value="">Select Class</option>';
                   $("#class1").html(optionString);

                   $.each(data.options, function(key, obj)
                   {
                        optionString += '<option value="'+obj.rack_id+'">'+obj.rack_name+'</option>';

                   })
                   $("#class_id").html(optionString);
                   window.location = BASE_URL + '/report/index/coverage-report#/coverage/'+student_id+'/'+class_id;
                }
            });
        //window.location = BASE_URL + '/report/index/coverage-report#/coverage/'+student_id+'/'+class_id;
    }
    function studentOperations(studentId, type, id, actiontype, actortype) {
        
        if (type == 'delete') {
            if (!confirm("Are you sure, you want to delete this request? You won't be able to recover any data of this student."))
            {
                $('.common-action').prop('checked', false);
                return false;
            }
            else
            {
                //$('#loadding1').show();
                $('#loaddingaction').show();
            }
        } else {
            //$('#loadding1').show();
            $('#loaddingaction').show();
        }

        $.ajax({
            type: 'POST',
            url: '<?php echo $this->Url('mentorRequests') ?>',
            data: {ids: studentId, type: type, id: id, actiontype: actiontype, actortype: actortype},
            success: function(data) {
                $('.upload1').hide();
                $('.download1').hide();
                $('.feedback1').hide();
                /*if(type=='delete'){
                 $('#loadding').hide();
                 }else if(type=='active'){
                 $('#loadding').hide();
                 }else if(type=='deActive'){
                 $('#loadding').hide();
                 }*/   // 
                if (data) {
                    //$('#loadding1').show();
                    $('#loaddingaction').show();
                    $.ajax({
                        url: '<?php echo $this->Url('my-students') ?>',
                        success: function(data1) {
                            $("#mentorsTable").html($(data1).find("#mentorsTable").html());
                            //$('#loadding1').hide();
                            $('#loaddingaction').hide();
                            $('#actionModal').modal('hide');
                            if (type == 'delete') {
                                //$('#succussesMessageload').html('');
                                //$('#succussesMessageload').html('');
                                $('#succussesMessageload').html('<b style="color:green;">Selected student is successfully Deleted</b>');
                                $('#succussesMessageload').show().delay(5000).fadeOut();
                            } else if (type == 'active') {
                                $('#succussesMessageload').html('');
                                $('#succussesMessageload').html('<b style="color:green;">Selected students is successfully Activated</b>');
                                $('#succussesMessageload').show().delay(5000).fadeOut();
                                //$('#succussesMessageload').html('');

                            } else if (type == 'deActive') {
                                //$('#succussesMessageload').html('');
                                //$('#succussesMessageload').html('');
                                $('#succussesMessageload').html('<b style="color:green;">Selected student is successfully Deleted</b>');
                                $('#succussesMessageload').show().delay(5000).fadeOut();
                            }



                            //$('#mentorsTable').html(data);
                            //}

                        }
                    })
                }

            }
        });
        //}	
    }

    $('#Student_Name').focusout(function(e) {
        var mentorName = $('#Student_Name').val();
        var mName = mentorName.replace(' ', '');
        //        alert(mName);
        var mentorId = $('#' + mName).val();
        var relationshipId = $('#Relationship').val();
        if (mentorName != '') {
            $('#emailLoaddrop').show();
            $.ajax({
                type: 'POST',
                url: BASE_URL + '/chkMentor',
                dataType: "json",
                data: {mentorId: mentorId, mentorName: mentorName, relationshipId: relationshipId},
                success: function(data) {
                    $('#emailLoaddrop').hide();

                    if (data.output == 'success') {
                        $('#emailLoaddrop').show();
                        $('#Student_Email').val(data.mentorEmail);
                        var mentorSubject = $('#mentor_subject').val();
                        var mentorName = $('#Student_Name').val();
                        var mName = mentorName.replace(' ', '');
                        var mentorId = $('#' + mName).val();
                        if (mentorId != '') {
                            $('#emailLoaddrop').hide();
                            /*$.ajax({
                             type		:	'POST',
                             url			:   BASE_URL+'/account/check-mentor-subject',
                             data		:	{mentorId:mentorId,mentorSubject:mentorSubject},
                             success: function(data){
                                     
                             if(data.output=='0'){ 
                             $('#succussesMessage').html('Please select mentor subject(s) as  '+data.subject.replace(/,\s*$/, ""));
                             $('#succussesMessage').show().delay(4000).fadeOut();
                             $('#mentorSubjectId').val(data.subjectId);
                             $('#mentorSubjectName').val(data.subject);
                             }else{
                             $('#mentorSubjectId').val('');
                             $('#succussesMessage').html('');
                             }
                             }
                             });*/
                        } else {
                            $('#mentorSubjectId').val('');
                        }
                    } else {
                        $('#mentorSubjectId').val('');
                        $('#Student_Email').val('');
                        $('#Mentor_Number').val('');
                        //$('#succussesMessageload').html('Mentor does not exist');
                    }
                }
            });
        }
    });
    
    function closeinvitelearnerdiv(){
        $(".register_overlay").hide();
        $("#add_learner_subject_popup").hide();
    }
    
    function addsubjecttolearner(student_mentor_id, board_id, class_id,board_name,class_name) {
        $("#student_mentor_id").val(student_mentor_id);
        $("#invited_learner_board").html(board_name);
        $("#invited_learner_class").html(class_name);
        $(".register_overlay").show();
        $("#add_learner_subject_popup").show();
        $.ajax({
            type: 'POST',
            url: 'lms/index/containerlist/' + class_id,
            dataType: 'json',
            success: function(data) {
                if (data != ''){
                    $("#invited_learner_subject").html('<option selected="" value="">Select Subject</option>');
                    $.each(data.options, function(i, el) {
                    $("#invited_learner_subject").append($("<option>").attr("value", el.rack_id).text(el.rack_name));
                });
                }else{
                       $("#invited_learner_subject").html('<option selected="" value="">Select Subject</option>');
                    }
                }
         });
    }
    

    function mymentor_subform(e) {
        if (e.keyCode == 13) {
            return submitForm();
        }
    }
    
//    $('#submitemail').on('click', function (e) {
//       submitForm(); 
//     //your awesome code here
//
//})
    
    
    function submitForm() {
        var letters = /^[a-zA-Z ]*$/;
        var mentorname = $('#Student_Name').val();
        var emailCheck = $('#Student_Email').val();
        var class_id = $('#class_id').val();
        var board_id = $('#board_id').val();
        
        var flag = true;
        if ($('#Relationship').val() == "") {
            $('#errorRelationship').html('Please enter relationship.');
            flag = false;
        } else {
            $('#errorRelationship').html('&nbsp;');
        }

        if (mentorname == "") {
            $('#errorStudent_Name').html('Please enter student name.');
            flag = false;
        } else if (!mentorname.match(letters)) {
            $('#errorStudent_Name').html('Please enter only alphabets.');
            flag = false;
        } else {
            $('#errorStudent_Name').html('');
        }

        if (emailCheck == "") {
            $('#erroremail').html('Please enter student email address.');
            flag = false;
        } else if (checkEmail(emailCheck) == false) {
            $('#erroremail').html('Please enter a valid email address.');
            flag = false;
        } else {
            $('#erroremail').html('');
        }

        if ($('#board_id').val() == '' || $('#board_id').val() == '0') {
            $('#errormentorBoard').html('Please select Board');
            flag = false;
        } else {
            $('#errormentorBoard').html('');
        }

        if ($('#class_id').val() == '' || $('#class_id').val() == '0') {
            $('#errormentorClass').html('Please select Class');
            flag = false;
        } else {
            $('#errormentorClass').html('');
        }

        if ($('#mentor_subject').val() == '') {
            $('#errormentorSubject').html('Please select subject');
            flag = false;
        } else {
            $('#errormentorSubject').html('');
        }
 
        if (flag == false) {
            return false;
        } else {
            var mentorSubject = $('#mentor_subject').val();
            var Mentor_Email = $('#Student_Email').val();
            var Mentor_Name = $('#Student_Name').val();
            var Relationship = $('#Relationship').val();

            $('#loadding').show();
            var mentorName = $('#Student_Name').val();
            var mName = mentorName.replace(' ', '');
            var mentorId = $('#' + mName).val();
            $('.errorfrm_mentor').css('display','block');
            if (mentorId != '' && mentorId != 'undefined') {
                $.ajax({
                    type: 'POST',
                    url: '<?php echo $this->Url('addStudentDetails'); ?>',
                    data: {mentorSubject: mentorSubject, Mentor_Email: Mentor_Email, classId: class_id, boardId:board_id, Mentor_Name: Mentor_Name, Relationship: Relationship},
                    dataType: 'json',
                    success: function(data) {
                        
                        $('#loadding').show();
                        $.ajax({
                            url: '<?php echo $this->Url('my-students'); ?>',
                            success: function(data1) {
                                $("#mentorsTable").html($(data1).find("#mentorsTable").html());
                            }
                        });
                        
                        if (data.output != '0') {
                            if (data.output == 'notexist') {
                                $('#loadding').hide();
                                $('#succussesMessageload').html('Requested Student not exist');
                                $('#succussesMessageload').show().delay(5000).fadeOut();
                                $("#Student_Name").attr("placeholder", "Please enter student name").val("");
                                $("#Student_Email").attr("placeholder", "Please enter student email address").val("");
                            }else if (data.output == 'duplicateinvite') {
                                $('#loadding').hide();
                                $('#succussesMessageload').html('You have already invited user to be his student');
                                $('#succussesMessageload').show().delay(5000).fadeOut();
                                $("#Student_Name").attr("placeholder", "Please enter student name").val("");
                                $("#Student_Email").attr("placeholder", "Please enter student email address").val("");
                            }
                            else if(data.output == 'self') {
                                $('#loadding').hide();
                                $('#succussesMessageload').html('You can not add your email as Student.');
                                $('#succussesMessageload').show().delay(5000).fadeOut();
                                $("#Student_Name").attr("placeholder", "Please enter student name").val("");
                                $("#Student_Email").attr("placeholder", "Please enter student email address").val("");
                            }else if (data.output == 'successInvitation') {
                                $('#loadding').hide();
                                $('#succussesMessageload').html('<b style="color:green;">Learner has been invited successfully</b>');
                                $('#succussesMessageload').show().delay(5000).fadeOut();
                                $("#Student_Name").attr("placeholder", "Please enter student name").val("");
                                $("#Student_Email").attr("placeholder", "Please enter student email address").val("");
                            }else {
                                $('#loadding').hide();
                                $('#succussesMessageload').html('<b style="color:green;">Your request has been sent successfully</b>');
                                $('#succussesMessageload').show().delay(5000).fadeOut();
                                $("#Student_Name").attr("placeholder", "Please enter student name").val("");
                                $("#Student_Email").attr("placeholder", "Please enter student email address").val("");
                                 setTimeout(function(){
                                    $('#add-mentor-tog').trigger('click');
                                },5000);
                            }

                        } else {

                            $('#loadding').hide();
                            $('#succussesMessageload').html('Request to this user for this subject is already sent');
                            $('#succussesMessageload').show().delay(5000).fadeOut();
                            //$('input,textarea').placeholder();
                        }
                        
                    }
                });
             
                $('#succussesMessageload').html('<b style="color:green;">Your request has been sent successfully</b>');
            } else {
                $('#loadding').hide();
                $('#mentorSubjectId').val('');
            }
        }
    }
    
    
    function submitInvitedLearnerSubject() {
        var letters = /^[a-zA-Z ]*$/;
        var mentorname = $('#Student_Name').val();
        var emailCheck = $('#Student_Email').val();
        var class_id = $('#class_id').val();
        
        var flag = true;
        

        if ($('#invited_learner_subject').val() == '') {
            $('#errorinvitedlearnerSubject').html('Please select subject');
            flag = false;
        } else {
            $('#errorinvitedlearnerSubject').html('');
        }
 
        if (flag == false) {
            return false;
        } else {
            var student_mentor_id = $("#student_mentor_id").val();
            $("loadding_add_subject").show();
            var mentorSubject = $('#invited_learner_subject').val();

            $('#loadding').show();
            
            
            $('.errorfrm_mentor').css('display','block');
            if (student_mentor_id != '' && student_mentor_id != 'undefined') {
                $.ajax({
                    type: 'POST',
                    url: '<?php echo $this->Url('addSubjectForInvitedLearner'); ?>',
                    data: {mentorSubject: mentorSubject, student_mentor_id: student_mentor_id},
                    dataType: 'json',
                    success: function(data) {
                        
                        $('#loadding').show();
                        $.ajax({
                            url: '<?php echo $this->Url('my-students'); ?>',
                            success: function(data1) {
                                $("#mentorsTable").html($(data1).find("#mentorsTable").html());
                            }
                        });
                        $(".register_overlay").hide();
                        $("#add_learner_subject_popup").hide();
                        
                    }
                });
             
                $('#succussesMessageload').html('<b style="color:green;">Your request has been sent successfully</b>');
            } else {
                $('#loadding').hide();
                $('#mentorSubjectId').val('');
            }
        }
    }
    
    function checkStatus(value, url,type)
    {
        if (value == 0) {
            alert('Not Active');
        } else {
            window.location = "<?php echo $this->Url('my-students-feedback') ?>/" + url+'-'+type;
        }
    }

    function studentProfile(user_id)
    {
        window.location = "<?php echo $this->Url('zfcuser/student-profile'); ?>/" + user_id;
    }
</script>