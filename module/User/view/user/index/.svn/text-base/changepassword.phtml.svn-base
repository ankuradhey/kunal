<?php

$form = $this->changePasswordForm;

$form->prepare();
$form->setAttribute('action', $this->url('zfcuser/changepassword'));
$form->setAttribute('method', 'post');
$form->setAttribute('class', 'form-horizontal');
$form->setAttribute('id', 'change-pass-form');

$emailElement = $form->get('identity');
$emailElement->setValue($this->zfcUserIdentity()->getEmail()); 
?>

<link href="<?php echo $this->cdn("/css/website/profile.css"); ?>" rel="stylesheet">
<!--Content section start here-->
<div id="content" class="profile-pages">
    <div class="container">
        <div class="row">
            <div class="myprofile-content">
                <div class="profile-view globle-click clearfix">
                    <strong>My Profile</strong>
                        <i class="icons-ar"></i>	
                </div>
<?php echo $this->partial('user/index/profile-menu.phtml',array('page'=>'myProfile','addedmentors'=>$addedMentors,'addedStudents' => $addedStudents));?>
      
        <section class="profile-block">
                <div class="changePassword">
                   <?php echo $this->form()->openTag($form); ?>
                  <?php echo $this->formInput($form->get('identity')); ?>
                    
                    <div style="margin-left: 50px">
                        <span class="valid-error" id="ajax_confirmerrormsg" style="display:block;position:inherit; padding-left:160px;color:red;"></span>
                        <span class="valid-error greencolor" id="ajax_successmsg" style="display:block;color:#008000; position:inherit; padding-left:160px;"></span>
                        
                    </div>
                    
                  <div class="form-group">
                     
		    <label for="cpass" class="col-sm-2 control-label"><?php echo $this->formLabel($form->get('credential')); ?><sup>*</sup></label>
		    <div class="col-sm-5">
		      <?php echo $this->formInput($form->get('credential'));  ?>
                        
		    </div>
                    
		  </div>
               
                    
                 <div class="form-group">
		    <label for="npass" class="col-sm-2 control-label"><?php echo $this->formLabel($form->get('newCredential')); ?><sup>*</sup></label>
		    <div class="col-sm-5">
		     <?php echo $this->formInput($form->get('newCredential'));?>
		    </div>
		  </div>
		 
                    
                 <div class="form-group">
		    <label for="npass" class="col-sm-2 control-label"><?php echo $this->formLabel($form->get('newCredentialVerify')); ?><sup>*</sup></label>
		    <div class="col-sm-5">
		     <?php echo $this->formInput($form->get('newCredentialVerify'));?>
		    </div>
		  </div>
                    
                    
                    <div class="form-group last">
		    <label for="vpass" class="col-sm-2 control-label">&nbsp;</label>
		    <div class="col-sm-5">
                  <?php 
                    $submitButton = $form->get('submit');
                    
                    //$submitButton->setAttribute('src', $this->basePath().'/images/Home-Login_Forgot_Password/button_reset.png');
                    echo $this->formInput($form->get('submit')); ?>
<!--		      <button class="btn btn-primary">
                          RESET PASSWORD</button>
		    </div>-->
		    </div>
                    
                    
					
                    </div>
				
            <?php echo $this->form()->closeTag(); ?>                      
					
				 

        </div>
          </section>
                </div>
</div>
 </div>
</div>
<script type="text/javascript">
    $(document).ready(function(){
        $('#change-password').click(function(){
            var formdata = $("#change-pass-form").serialize();
            $.ajax({
                type: 'POST',
                url: '<?php echo $this->basePath(); ?>' + "/user/change-password",
                dataType: 'json',
                data: formdata,
                success: function(data) {
                    $('#ajax_confirmerrormsg').html('');
                    $('#ajax_successmsg').html('');
                    setTimeout(function() {
                        $('#ajax_confirmerrormsg').html('');
                        $('#ajax_successmsg').html('');
                    }, 5000);
                    if(data.response == 'required') {
                        $('#ajax_confirmerrormsg').html('All Fields are required');
                    } else if(data.response == 'current') {
                        $('#ajax_confirmerrormsg').html('The password entered is incorrect. Please try again!');
                    } else if(data.response == 'match') {
                        $('#ajax_confirmerrormsg').html('The new password and confirmation password do not match. Please try again!');
                    } else if(data.response == 'length') {
                        $('#ajax_confirmerrormsg').html('Password length should be minimum of six characters!');
                    } else if(data.response == 'space') {
                        $('#ajax_confirmerrormsg').html('Password should not have blank spaces!');
                    } else if(data.response == 'special') {
                        $('#ajax_confirmerrormsg').html('Password should not have junk characters. Allowed Special Characters are ! @ ; , $ # & ( ) + : . _');
                    } else if(data.status == false) {
                        $('#ajax_confirmerrormsg').html('Unable to update your password. Please try again.');
                    } else if(data.status == true) {
                        alert('Password changed successfully.');
                        //$('#ajax_successmsg').html('Password changed successfully.');
                        $('a.homelink').trigger('click');
                        var href = $('a.homelink').attr('href');
                        window.location.href= href;
                    }
                }
            });
            return false; 
        });
        $('input[name="credential"]').val('');
        $('input[name="newCredential"]').val('');
        $('input[name="newCredentialVerify"]').val('');
    });
</script>  