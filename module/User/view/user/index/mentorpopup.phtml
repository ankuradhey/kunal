<link href="<?php echo $this->cdn("/css/website/profile.css"); ?>" rel="stylesheet">
<style> .addmentor-form .f-width .sbHolder {width: auto;}</style>
<div class="form-block addmentor-form" style="display: block !important;">
    <form class="form-horizontal" id="user-my-mentor_form" method="post">
        <span class="errorfrm_mentor" id="succussesMessageload"></span>
        <div class="errorfrm_mymentor" id="errorRelationship">&nbsp;</div>
        <div class="form-group">
            <label class="col-sm-2 control-label">Name<sup>*</sup></label>
            <div class="col-xs-12 col-sm-9">
                <div class="col-xs-3 col-sm-2 mentor-select">
                    <select class="CostomSelect" name="gender">
                        <option value="">Mr.</option>
                        <option value="">Ms.</option>
                    </select>	
                </div>	
                <div class="col-xs-9 col-sm-5 h-width">	
                    <input id="Mentor_Name"  type="text" name="Mentor_Name" class="form-control" placeholder="Please enter mentor name">
                </div>
                <div class="clearfix"></div>
                <div class="errorfrm_mymentor" id="errorMentor_Name">&nbsp;</div>
            </div>

        </div>

        <div class="form-group">
            <label class="col-sm-2 control-label">Email<sup>*</sup></label>
            <div class="col-sm-5 f-width">	
                <input type="email" id="Mentor_Email" name="Mentor_Email"  class="form-control" placeholder="Please enter mentor email address">
                <div class="clearfix"></div>
                 <div class="errorfrm_mymentor" id="erroremail">&nbsp;</div>
            </div>
        </div>
        <input type="hidden" id="Mentor_phone_id" name="Mentor_phone_id" value="">

        <div class="form-group">
            <label class="col-sm-2 control-label">Board<sup>*</sup></label>
            <div class="col-sm-5 f-width">	
                <select class="CostomSelect" name="board_id" id="board_id">
                    <option value="0">Select a board </option>
                    <?php
                    if (count($this->boards)) {
                        foreach ($this->boards as $boards) {
                            ?>
                            <option value="<?php echo $boards[0]['customBoard']['customBoardId'] ?>"><?php echo $boards[0]['customBoard']['boardName'] ?></option>
                            <?php
                        }
                    }
                    ?>
                </select>
                <div class="clearfix"></div>
               <div class="errorfrm_mymentor" id="errormentorBoard">&nbsp;</div>
            </div>
        </div>


        <div class="form-group">
            <label class="col-sm-2 control-label">Class<sup>*</sup></label>
            <div class="col-sm-5 f-width" id="selectedClass">	
                <select class="CostomSelect" name="class_id" id="class_id">
                    <option selected="selected" value="0">Select a Class</option>

                </select>
                 <div class="clearfix"></div>
                  <div class="errorfrm_mymentor" id="errormentorClass">&nbsp;</div>
            </div>
        </div>


        <div class="form-group">
            <label class="col-sm-2 control-label hidden-xs">&nbsp;</label>
            <div class="col-sm-5 f-width">	
                <div class="radio-box">
                    <input type="radio" name="subject_type" id="subscribed" value="subscribed" checked/>
                    <label for="subscribed">Subscribed Subjects</label>	
                </div>
                <div class="radio-box">
                    <input type="radio" name="subject_type" id="all" value="all" />
                    <label for="all">All Subjects</label>	
                </div>
            </div>
        </div>
        <div class="form-group">
            <label class="col-sm-2 control-label">Subject<sup>*</sup></label>
            <div class="col-sm-5 f-width">	
                <select name="mentor_subject" class="form-control" id="mentor_subject" multiple="multiple" >
                    <option value="" selected>Select Subject</option>
                    <?php
                    if(count($this->subjectdetails) != 0) {
                        foreach ($this->subjectdetails as $subjectdetails) { ?>									
                            <option value="<?php echo $subjectdetails->board_class_subject_id; ?>"><?php echo $subjectdetails->subject_name; ?></option>
                            <?php
                        }
                    }
                    ?> 
                </select>
                <div class="clearfix"></div>
                  <span class="errorfrm_mymentor" id="errormentorSubject">&nbsp;</span>
        <span class="errorfrm_mymentor" id="errorsameemailid">&nbsp;</span> 
            </div>
            <span style="display:none; padding-left: 15px;" id="loaddingsubject"><img src="<?php echo $this->cdn() ?>/images/loader16.gif"></span>
        </div>
   <input type = "hidden" name="lptpage" value="lptpage" id="mentorpopup">

        <div class="form-group">
            <label class="col-sm-2 control-label hidden-xs">&nbsp;</label>
            <div class="col-sm-5">	
                <button class="btn btn-primary user-my-mentor_form-submit" onclick="return submitForm();" type="button">SUBMIT</button>
                <button class="btn cancel-btn user-my-mentor_form-cancel" type="submit">CANCEL</button>
            </div>
            <span style="display:none;" id="loadding"><img src="<?php echo $this->cdn() ?>/images/website/loader16.gif"></span>
        </div>
        <div class="errorfrm_mymentor" id="succussesMessage"></div>

        <?php
        if (count($this->mentorssIds) != 0) {
            foreach ($this->mentorssIds as $key => $mentorssIds) {
                ?>
                <input type="hidden" id="<?php echo str_replace(' ', '', $key) ?>" name="<?php echo str_replace(' ', '', $key) ?>" value="<?php echo $mentorssIds ?>">
                <?php
            }
        }
        ?>

    </form>
</div>

<script>

 jQuery(document).ready(function() {
     $(".CostomSelect").each(function(){
            $(this).wrap("<span class='select-wrapper'></span>");
            $(this).after("<span class='holder'></span>");
        });
        $(".CostomSelect").change(function(){
            var selectedOption = $(this).find(":selected").text();
            $(this).next(".holder").text(selectedOption);
        }).trigger('change');
        // radio button selected 
        $("#subscribed").prop("checked", true);
        $('input[type=radio]').click(function() {
            var RadioID = $(this).prop('id');
            showall(RadioID);
        });   
      });      
    
  $("#board_id").change(function() {	
            $("#class_id").parent().find(".holders").text("");
            $("#class_id").parent().find(".holders").text("Select Class");
            var classid = $("#board_id option:selected").val();
            $("#mentor_subject").html('<option selected="" value="">Select Subject</option>');
            $.ajax({
                type: 'POST',
                url: BASE_URL + '/lms/index/custom-containerlist/' + $(this).val(),
                dataType: 'json',
                success: function(data) {
                    var classEle = $("#class_id");
                    var html = '';
                    if (data != '') {    
                        html += '<select id="class_id" name="class_id" class="CostomSelect"><option selected="" value="">Select Class</option>';
                        $.each(data.options, function(i, el) {
                            html += '<option value="'+el.rack_id+'">'+el.rack_name+'</option>';
                        });
                       html+='</select>';
                       $('#selectedClass').html(html).promise().done(function(){
                           $('#class_id').selectbox({
                               onChange:function(val,inst){
                                   var RadioID = $('input[type=radio]').prop('id');                                       
                                       showall(RadioID);
                                       return false;
                                    $.ajax({
                                        type: 'POST',
                                        url: BASE_URL+'/lms/index/containerlist/' + val,
                                        dataType: 'json',
                                        success: function(data) {
                                            if (data != ''){
                                                $("#mentor_subject").html('<option selected="" value="">Select Subject</option>');
                                                $.each(data.options, function(i, el) {
                                                $("#mentor_subject").append($("<option>").attr("value", el.rack_id).text(el.rack_name));
                                            });
                                            }else{
                                                   $("#mentor_subject").html('<option selected="" value="">Select Subject</option>');
                                                }
                                            }
                                     });
                                  }
                            });
                        });                      
                }else{
                    classEle.html('<option selected="" value="">Select Class</option>');
               }
            }
        });
   });  
  
  function showall(subjects) {
        var classid = $("#class_id option:selected").val();
        if (classid == 0)
            return false;
        $.each($('[name=subject_type]'), function(i, el) {
            if (el.checked)
                subjecttype = el.value;
        });
        $("#loaddingsubject").show();
        $.ajax({
            type: 'POST',
            url: '<?php echo $this->Url("getSubjectlist") ?>',
            data: {classid: classid, subjecttype: subjecttype},
            success: function(data) {
                $("#loaddingsubject").hide();
                if (data != '') {
                    $("#mentor_subject").html('<option selected="" value="">Select Subject</option>');
                    $("#mentor_subject").append(data);
                } else {
                    $("#mentor_subject").html('<option selected="" value="">Select Subject</option>');
                }




            }
        });

    }  
 function submitForm() {
        var letters = /^[a-zA-Z ]*$/;
        var mentorname = $('#Mentor_Name').val();
        var emailCheck = $('#Mentor_Email').val();
        var class_id = $('#class_id').val();
        
        var flag = true;
        if ($('#Relationship').val() == "") {
            $('#errorRelationship').html('Please enter relationship.');
            flag = false;
        } else {
            $('#errorRelationship').html('&nbsp;');
        }
       
        if (mentorname == "") {
            $('#errorMentor_Name').html('Please enter mentor name.');
            flag = false;
        } else if (!mentorname.match(letters)) {
            $('#errorMentor_Name').html('Please enter only alphabets.');
            flag = false;
        } else {
            $('#errorMentor_Name').html('');
        }

        if (emailCheck == "") {
            $('#erroremail').html('Please enter mentor email address.');
            flag = false;
        } else if (checkEmail(emailCheck) == false) {
            $('#erroremail').html('Please enter a valid email address.');
            flag = false;
        } else {
            $('#erroremail').html('');
        }
<?php if (is_object($userObj->getEmail())) { ?>
            var loggedemailid = '<?php echo $userObj->getEmail(); ?>';
            if (emailCheck == loggedemailid) {
                $('#errorsameemailid').html('You are already logged in.');
                flag = false;
            } else {
                $('#errorsameemailid').html('');
            }
<?php } ?>

        if ($('#board_id').val() == '' || $('#board_id').val() == '0') {
            $('#errormentorBoard').html('Please select Board');
            flag = false;
        } else {
            $('#errormentorBoard').html('');
        }

        if ($('#class_id').val() == '' || $('#class_id').val() == '0') {
            $('#errormentorClass').html('Please select Class');
            flag = false;
        } else {
            $('#errormentorClass').html('');
        }


        if ($('#mentor_subject').val() == '') {
            $('#errormentorSubject').html('Please select subject');
            flag = false;
        } else {
            $('#errormentorSubject').html('');
        }
       
        if (flag == false) {
            return false;
        } else {
            var mentorSubject = $('#mentor_subject').val();
            var Mentor_Email = $('#Mentor_Email').val();
            var Mentor_Name = $('#Mentor_Name').val();
            var Relationship = $('#Relationship').val();
            var Board_Id= $('#board_id').val();

            $('#loadding').show();
            var mentorName = $('#Mentor_Name').val();
            var mName = mentorName.replace(' ', '');
           
            var mentorId = $('#' + mName).val();
    
            if (mentorId != '') {
                $('#loadding').show();
               
                $.ajax({
                    type: 'POST',
                    url: '<?php echo $this->Url('add-mentor-details'); ?>',
                    data: {mentorSubject: mentorSubject, Mentor_Email: Mentor_Email,classId: class_id, Mentor_Name: Mentor_Name, Relationship: Relationship,BoardId: Board_Id},
                    dataType: 'json',
                    success: function(data) {
                        //$('#loadding').show();
                        
                        $.ajax({
                            url: '<?php echo $this->Url('mymentor'); ?>',
                            success: function(data1) {
                                $("#mentorsTable").html($(data1).find("#mentorsTable").html());
                                
                            }
                        });
                        
                        if (data.output != '0') {
                            if (data.output == 'notexist') {
                                $('#loadding').hide();
                                $('#succussesMessageload').html('Requested Mentor not exist');
                                $('#succussesMessageload').show().delay(5000).fadeOut();
                                $("#Mentor_Name").attr("placeholder", "Please enter mentor name").val("");
                                $("#Mentor_Email").attr("placeholder", "Please enter mentor email address").val("");

                            }else if(data.output == 'self') {
                                $('#loadding').hide();
                                $('#succussesMessageload').html('You can not add your email as Mentor');
                                $('#succussesMessageload').show().delay(5000).fadeOut();
                                $("#Mentor_Name").attr("placeholder", "Please enter mentor name").val("");
                                $("#Mentor_Email").attr("placeholder", "Please enter mentor email address").val("");
                            } else {
                                $('#loadding').hide();
                                if(data.response_type=='success') {
                                    $('#succussesMessageload').html('Your request has been sent successfully');
                                    setTimeout(function(){
                                       closementorpopup();
                                    },2000);
                                }
                                $('#succussesMessageload').show().delay(5000).fadeOut();
                                $("#Mentor_Name").attr("placeholder", "Please enter mentor name").val("");
                                $("#Mentor_Email").attr("placeholder", "Please enter mentor email address").val("");
                                setTimeout(function(){
                                    $('#add-mentor-tog').trigger('click');
                                },5000);
                            }
                            
                        } else {
                            $('#loadding').hide();
                            $('#succussesMessageload').html('Request for this subject is already sent');
                            $('#succussesMessageload').show().delay(5000).fadeOut();
                            //$('input,textarea').placeholder();

                        }
                        
                    }
                });
              
                
            } else {
                $('#loadding').hide();
                $('#mentorSubjectId').val('');
            }
        }
    }

</script>    