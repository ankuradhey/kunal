<?php $basePath = $this->basePath(); ?>    
<div class="notification-border-box">
        <div class="notifi_box_header">
            <p>Notification  <?php if (count($this->newnotification) != 0) { ?>
                <strong class="alert-msg img-circle"><span><?php echo count($this->newnotification); ?></span></strong>
                <?php } ?>
            </p>
        </div>
        <?php $countli = 0;?>
        <?php if (count($this->newnotification) != 0) { ?>
        <ul class="custom-scroll-notification" id="notificationScrollbar">
                <?php
                foreach ($this->newnotification as $notify) {
                    if($notify->notification_activity_type=='admin') {
                        if($notify->notify_appear_type!='') {
                            $startDate = date('Y-m-d',  strtotime($notify->notification_start_date));
                            if($startDate > date('Y-m-d')) {
                                continue;
                            }
                        }
                    }
                    $countli++;
                    $day = '';
                    if ($notify->created_date != '') {
                        $loggeddate = $notify->created_date;
                        $timestamp = explode(" ", $loggeddate);
                        $date = explode('-', $timestamp[0]);
                        $year = $date[0];
                        $month = $date[1];
                        $day = $date[2];
                        $mnth = '';
                        if ($month == '1') {
                            $mnth = 'Jan';
                        } else if ($month == '2') {
                            $mnth = 'Feb';
                        } else if ($month == '3') {
                            $mnth = 'Mar';
                        } else if ($month == '4') {
                            $mnth = 'Apr';
                        } else if ($month == '5') {
                            $mnth = 'May';
                        } else if ($month == '6') {
                            $mnth = 'Jun';
                        } else if ($month == '7') {
                            $mnth = 'Jul';
                        } else if ($month == '8') {
                            $mnth = 'Aug';
                        } else if ($month == '9') {
                            $mnth = 'Sep';
                        } else if ($month == '10') {
                            $mnth = 'Oct';
                        } else if ($month == '11') {
                            $mnth = 'Nov';
                        } else if ($month == '12') {
                            $mnth = 'Dec';
                        }
                    }?>
                    <?php
                    //$pos = strpos($notify->notification_url, 'http');echo "dddd==>".$pos;exit;
                    if ($notify->notification_url != '') {
                        if (strpos($notify->notification_url, "ttp") == TRUE) {
                            $notUrl = $notify->notification_url;
                        } else {
                            $url = explode("/", $notify->notification_url);
                            ?> 
                             <?php
//                            end($url);
//                            $totalurlcount = key($url)+1;
//                            
//                            for($i =0; $i<$totalurlcount;$i++)
//                            {
//                              if($i == 0){
//                                   $notifyurl = $url[$i];
//                               }else{
//                                   $notifyurl .= '/'.$url[$i];
//                               }
//                               
//                            }
//                            echo "url===>".$notifyurl;
                             //echo '<pre>'; print_r($url); exit;
                                //$basePath
                                $checkUrlCount = explode(".",$url['0']);
                                //echo count($checkUrlCount); exit;
                                
                                //echo $url['0']; exit;
                                if (strpos($url['0'],'http://') !== false) {
                                    
                                } else {
                                    if(count($checkUrlCount)==1){
                                        
                                    }else{
                                        $url['0'] = 'http://'.$url['0'];
                                    }
                                }
                                //echo $url['0']; exit;
                                if (isset($url['2']) != '') {
                                    if(count($checkUrlCount)==1){ 
                                        $notUrl = $this->Url($url['0']) . '/' . $url['1'] . '/' . $url['2'];
                                    } else { 
                                        $notUrl = $url['0'] . '/' . $url['1'] . '/' . $url['2'];
                                    }
                                } else if (isset($url['1']) != '') {
                                    if(count($checkUrlCount)==1){ 
                                        $notUrl = $this->Url($url['0']) . '/' . $url['1'];
                                    } else {
                                        $notUrl = $url['0'] . '/' . $url['1'];
                                    }
                                } else {
                                    if(count($checkUrlCount)==1){
                                         $notUrl = $this->Url($url['0']);
                                    }else{
                                        $notUrl = $url['0'];
                                    }
                                }
                           // $notUrl = $this->Url($notifyurl);
                            }
                        } else {

                            $notUrl = '';
                        }   
                        //echo $notUrl; exit;
                        ?>
                    <li id="notification<?php echo $notify->notification_id; ?>" class="notification">
                    <?php if ($notify->type_id != 5) { ?>
                            <a href="<?php echo $notUrl; ?>" onclick="updatenotification(<?php echo $notify->notification_id; ?>, 'seen', '<?php echo $notUrl; ?>','<?php echo $notify->type_id; ?>')"><?php echo $notify->notification_text; ?></a>
                        <?php } else { ?>
                            <!--<a href="<?//php echo $notUrl; ?>" onclick="updatenotification(<?//php echo $notify->notification_id; ?>,'seen')" style="color:#FD0101"><?//php echo $notify->notification_text; ?></a>-->
                            <div onclick="updatenotification1(<?php echo $notify->notification_id; ?>, 'seen');" style="color:#FD0101"><?php echo $notify->notification_text; ?></div>
                        <?php } ?>
                        <span class="deletenotification" onclick="updatenotification(<?php echo $notify->notification_id; ?>, 'status','')"><img width="11" src="<?php echo $this->cdn() ?>/images/website/close_button_hover.png" /></span>
                        <span class="notification-date">(Date:<?php echo $day; ?>&nbsp;&nbsp;<?php echo $mnth; ?>&nbsp;&nbsp;<?php echo $year; ?></b>)</span>
                    </li>
                    <?php  } ?>
            </ul>
        <?php } else { ?>
            <ul>
                <li>
                    No New Notifications
                </li>
            </ul>
        <?php } ?>
    </div>


<script>
    
    function updatenotification(notificationId, type, url,type_id)
    {
       
        <?php $moduledetail = $this->ControllerName();     ?>
        var actionname = "<?php echo $moduledetail['action'] ?>";      
        
    
        $.ajax({
            async: false,
            type: 'POST',
            dataype: "json",
            url: BASE_URL + '/notification/index/updatenotificationstatus',
            data: {notificationId: notificationId, type: type},
            success: function(data) {
                $('#loaddingActivity').hide();
                   
                 if(type_id == '1' && url =='')
                  {
                       $('#locationpic').modal('show');
                       return false;
                  }   
                if (data['output'] == 'sucusses') {
                    if(url)
                        window.location.href = url;
                    else
                        location.reload();
                }
            }
        });

    }
    
    $(document).ready(function() {
        //var lilength = $('li.notification').length;
        //var orglen = lilength/2;
        var html = '<span>'+<?php echo $countli;?>+'</span>';
        $('.alert-msg').html(html); 
    });
</script>
<script type="text/javascript" src="<?php echo $this->basePath(); ?>/js/website/bootstrap-filestyle.js"></script>
<script type="text/javascript">			
    $('.image_file').filestyle({
            icon : false
    });
</script>

<div  class="modal fade location-popup" id="locationpic" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog">
      <div class="modal-content">
          <div class="modal-header">
                <h4 id="exampleModalLabel" class="modal-title">Update your Photo</h4>
          </div>
           <div class="modal-body">
               <span class="errorfrm1 text-center" id="errorclassname">&nbsp;</span>
               <div class="form-group clearfix">
             <?php  
                if ($user = $this->zfcUserIdentity()) {
                    $userGender = $user->getGender();
                }
               if(strtolower($userGender) == 'female') {  ?>
              <div class="col-sm-1 padd"><img id="blah" src="<?php echo $this->basePath();?>/images/avatar_100_G.png" style="height:39px;"></div>    
               <?php } else {?>
                    <div class="col-sm-1 padd"><img id="blah" src="<?php echo $this->basePath();?>/images/avatar_100_1x.png" style="height:39px;"></div>
               <?Php } ?>
                   <div class="col-sm-11 padd-right">
               <div class="photobrowser clearfix" style="width:100%; margin-top:0; ">                                   
                <div class="upload_File" style="width:100%;"><input type="file"  name="image_file" onchange="readURL(this);" class="image_file" id="image_file"></div>                                     
                
               </div>
                       <p style="margin-top: 3px;">(max file size 1mb)</p>
                  </div>
               </div>
          <div class="modal-body text-center"><a href="javascript:void(0)" onclick="skipprocess()" class="btn btn-warning" style="width:100px">Skip</a>
              <a href="javascript:void(0)" onclick="updatepicture()" class="btn btn-primary" style="width:100px">Update</a>
              <span id="loadingPostcom" style="display: none;"><img src="<?php echo $this->basePath();?>/images/website/netLoader.gif"></span>
          </div>
           </div>
      </div>
   </div>
</div>
<style>
    .photobrowser .form-control{ width: 80%;}
    .photobrowser .group-span-filestyle.input-group-btn{ width: 20%}
    .errorfrm1{ color:#f00; font-size:12px; padding: 5px 0 5px 100px;}
</style>

<script>
function updatepicture(){
  var type = "file";
  $("#loadingPostcom").css('display','inline-block');
  var file_data = $("#image_file").prop('files')[0];
  var files = $('#image_file').val();

     if(files =='')
     {
          $("#errorclassname").html("please choose file for upload");
          $("#loadingPostcom").css('display','none');
          return false;
     }   
     if(file_data.size>1048576)
     {
         $("#errorclassname").html("Image size should be below 1 mb");
         $('#image_file').val('');
         $("#loadingPostcom").css('display','none');
         return false;
     }  
  
            var form_data = new FormData();                  
            form_data.append('image_file', file_data);
            var data1 =type;
            form_data.append('data',data1);
           
        $.ajax({
            type: 'POST',
            cache: false,
            contentType: false,
            processData: false,
            url: BASE_URL + '/updatepackageprofile',
            data:form_data,
            success: function(data) {
                $("#loadingPostcom").css('display','none');
                if (data.output == 'success') {
                     location.reload();
                }else if(data.output =='false'){
                    
                   $("#errorclassname").html("Error: Only .jpg,.png,.gif,.pjpg images  for upload");
                }else if(data.output =='tfalse'){
                    $("#errorclassname").html("Error: File is corrupt Or not proper");
                }
            
            }
        });    
} 
function skipprocess(){
       $('#locationpic').modal('hide');
       location.reload();
   }
function readURL(input) {
        if (input.files && input.files[0]) {
            var reader = new FileReader();

            reader.onload = function (e) {
                $('#blah')
                    .attr('src', e.target.result)
                    .height(40);
            };

            reader.readAsDataURL(input.files[0]);
        }
    }


</script>   