<?php if($this->zfcUserIdentity() && $this->zfcUserIdentity()->getId()!=""){
       $userId = $this->zfcUserIdentity()->getId();
    ?>
<style>#dropdown_flag_customsd{display:block;float:left}#phonecode_msdd{width:110px!important}.dd .ddTitle .ddTitleText{padding-left:5px;padding-top:3px}</style>
<div class="main-containter">
<div class="clear"></div>
   <div class="sub-containter">
      <?php echo $this->partial('zfc-user/user/profile-menu.phtml',array('page'=>'change-profile','addedmentors'=>count($this->addedMentors),'addedStudents' => count($this->addedStudents)));?>
      <div class="clearfix"></div>
      <table cellpadding="0" cellspacing="0" width="100%" class="container-content">
         <tbody>
            <tr>
                 
                
               <?php   //$this->partial('account/account/account-menu-common.phtml',array('boardname'=>$this->user->board_name,'board_id'=>$this->user->board_id,'classname'=>$this->user->class_name,'class_id'=>$this->user->class_id));?>
               <td class="right-td">
                  <div class="right-content">
                      <?php if(isset($_GET['error']) && $_GET['error'] == 'false' ) { ?>  
                        <center><span style="color:red"><?php echo 'Error: Only .jpg,.png,.gif,.pjpg images  for upload'; ?></span></center>
                      <?php } if(isset($_GET['error']) && $_GET['error'] == 'tfalse' ){ ?>
                        <center><span style="color:red">     <?php echo "Error: File is corrupt Or not proper "; ?></span></center>
                      <?php } ?>
                      
                     <input type="hidden" value="nav_1" id="nav_find">
                     <form name="updateprofile" id="updateprofile" action="<?php //echo $this->URL('zfcuser/updateprofile') ?>" enctype="multipart/form-data"  method="post" >
                        <span style="font-size: 16px;" class="errorfrm1" id="starerr"></span>
                        <div class="form-container">
                           <div class="left-content-label le photolabel">Your Photo</div>
                           <div class="le filebrowse">
                              <div style="float:left;">
                                 <?php if(isset($this->user->user_photo) && $this->user->user_photo!=""){?>
                                 <img src="<?php echo $this->basePath() ?>/uploads/profileimages/<?php echo $this->user->user_photo."?".time();?>" style="" height="72" style="max-width:100px;"/>
                                 <?php }else if($this->user->gender=='Male' || $this->user->gender==''){?>
                                 <img src="<?php echo $this->basePath() ?>/images/avatar_100_1x.png" height="72" style="max-width:100px;"/>
                                 <?php }else if($this->user->gender=='Female'){?>
                                 <img src="<?php echo $this->basePath() ?>/images/avatar_100_G.png" height="72" style="max-width:100px;"/>
                                 <?php }?>
                                 <input type="hidden" id="hidfile" name="hidfile" value="<?php if(isset($this->user->user_photo)){echo $this->user->user_photo;}?>">
                                 
                              </div>
                              <div class="le photobrowser">
                                 <!--<input type="file" id="image_file" name="image_file" />-->
                                 <div class="custom-upload">
                                    <input type="file" name="image_file" id="image_file">
                                    <div class="fake-file">
                                       <input disabled="disabled">
                                    </div>
                                 </div>
                                 <div class="filebrowse_btm_label">(max file size 1Mb)</div>
                              </div>
                              <input type="hidden" name="fileerror" id="fileerror" value="0"/>
                           </div>
                           <div class="errorfrm1" id="errorimage">&nbsp;<?php echo $this->fileerror?></div>
                           <div class="errorfrm1" id="errorimage1"></div>
                        </div>
                        <div class="form-container">
                           <div class="left-content-label">Name<span class="staricon">*</span></div>
                           <div class="inputText">
                              <input  autofocus type="text" onkeypress="updateKeypress(event)" id="username" name="username" placeholder="Enter your name" value="<?php if(isset($this->user->firstName)){echo ucfirst($this->user->firstName);}?>" />
                              <p class="errorfrm1" id="errorname">&nbsp;</p>
                           </div>
                        </div>
                        <div class="form-container">
                           <div class="left-content-label">Gender<span class="staricon">*</span></div>
                           <div class="rd_btn radionButtonsn radion-check log-rhtbxs inputText_right">
                              <?php if(isset($this->user->gender) && $this->user->gender!=''){?>
                              <?php if($this->user->gender=="Male" || $this->user->gender=="male"){?>
                              <input type="radio" id="radio11" name="sex" value="Male" class="css-checkbox"checked="checked"><label for="radio11" class="css-label">Male</label>
                              <input type="radio" id="radio12" name="sex" value="Female" class="css-checkbox"><label for="radio12" class="css-label">Female</label>
                              <?php }else if($this->user->gender=="Female" || $this->user->gender=="female"){?>
                              <input type="radio" id="radio11" name="sex" value="Male" class="css-checkbox"><label for="radio11" class="css-label">Male</label>
                              <input type="radio" id="radio12" name="sex" value="Female"checked="checked" class="css-checkbox"><label for="radio12" class="css-label">Female</label>
                              <?php }}else{?>
                              <input type="radio" id="radio11" name="sex" value="Male" class="css-checkbox" ><label for="radio11" class="css-label">Male</label>
                              <input type="radio" id="radio12" name="sex" value="Female" class="css-checkbox"><label for="radio12" class="css-label">Female</label>
                              <?php }?>
                              <p class="errorfrm1" id="errorgender">&nbsp;</p>
                           </div>
                        </div>
                        <div class="form-container">
                           <div class="left-content-label">I am a</div>
                           <div class="right-content-label">
                              <p><?php if(isset($this->usertypes) && count($this->usertypes)!=0){
                                  foreach($this->usertypes as $usertype){ if($this->user->user_type_id==$usertype->user_type_id){ echo $usertype->name;}}}?></p>
                              <input type ="hidden" name="usertype" value="<?php echo $this->user->user_type_id;?>"/>
                           </div>
                        </div>
                        						
                        <div class="form-container">
                           <div class="left-content-label">Mobile<span class="staricon">*</span></div>
                           <div class="inputText_right">
                              <?php $phonenumber[]=''; 
                              if(isset($this->user->mobile)){
                                  $phonenumber = explode('-', $this->user->mobile);
                                  $phoneCodeFlag = true;
                              }else{
                                  $phoneCodeFlag = false;
                              }
                              
                              ?>							  
                              <p id='dropdown_flag_customsd' class="dropdown_flags les">
                                 <select id="phonecode" name="phonecode">
                                    <?php if(isset($this->countries) && count($this->countries)>0){foreach($this->countries as $Countries){  ?>
                                    <?php if($phoneCodeFlag == true && $phonenumber['0']==$Countries->getphonecode()){?>
                                    <option value="+<?php echo $Countries->getphonecode(); ?>" data-image="<?php echo $this->basePath() ?>/images/flags/<?php echo strtolower($Countries->getiso())?>_32.png" selected="selected">+<?php echo $Countries->getphonecode() ?></option>
                                    <?php }else if($phoneCodeFlag == false && $countaryid == $Countries->getCountryId()){?>
                                    <option value="+<?php echo $Countries->getphonecode(); ?>" data-image="<?php echo $this->basePath() ?>/images/flags/<?php echo strtolower($Countries->getiso())?>_32.png" selected="selected">+<?php echo $Countries->getphonecode() ?></option>
                                    <?php }else{?>
                                    <option value="+<?php echo $Countries->getphonecode(); ?>" data-image="<?php echo $this->basePath() ?>/images/flags/<?php echo strtolower($Countries->getiso())?>_32.png">+<?php echo $Countries->getphonecode() ?></option>
                                    <?php }}}else{?>
                                    <option value="+<?php echo $Countries->getphonecode(); ?>" data-image="<?php echo $this->basePath() ?>/images/flags/<?php echo strtolower($Countries->getiso())?>_32.png">+<?php echo $Countries->getphonecode() ?></option>
                                    <?php }?>
                                 </select>
                              </p>
                              <p class="inputText_flag" style="height:33px;">
                                 <input style="height:33px;" type="text" onkeypress="updateKeypress(event)" id="phonenumber" name="phonenumber"  placeholder="Enter mobile number" value="<?php if(count($phonenumber)>1){if(isset($phonenumber['1'])){echo $phonenumber['1'];}}else{if(isset($phonenumber['0'])){echo $phonenumber['0'];}}?>" maxlength="10"/>
                              </p>
                              <br />
                              <p class="errorfrm1" style="top:57px;" id="errorphonenumber">&nbsp;</p>
                           </div>
                        </div>
                        <?php $name=''; 
                        if(isset($this->user->user_type_id) && $this->user->user_type_id !='2'){
                           $name='Student';
                           }else{
                           $name='Child';
                           }
                           ?>
                      
                        <?php if(isset($this->user->nameChild) && $this->user->nameChild!=""){?>
                        <div class="form-container">
                           <div class="left-content-label">My <?php echo $name; ?>'s Name</div>
                           <div class="right-content-label">
                              <p><?php if(isset($this->user->nameChild)){echo trim($this->user->nameChild,',');}?></p>
                              <p class="errorfrm1" id="erruchild">&nbsp;</p>
                           </div>
                        </div>
                        <?php }?>
                        <?php if($this->user->user_type_id == '1'){?>  							
                        <div class="form-container">
                           <div class="left-content-label">Board<span class="staricon">*</span></div>
                           <div class="dropdown">
                              <select name="board" class="custom-select_iam" id="board">
                                 
                                 <?php if(isset($this->boards)){ foreach($this->boards as $key=>$boards){ ?>
                                 <?php if($this->user->boardId==$key){?>
                                 <option value="<?php echo $key;?>" selected="selected"><?php echo $boards;?></option>
                                 <?php }else{?>
                                 <option value="<?php echo $key;?>"><?php echo $boards;?></option>
                                 <?php }}}?> 
                              </select>
                              <p class="errorfrm1" id="errorboard">&nbsp;</p>
                           </div>
                        </div>
                        <div class="form-container">
                           <div class="left-content-label">Class<span class="staricon">*</span></div>
                           <div class="dropdown" id="uclass" name="uclass">
                              <select id="classnames" class='custom-select_class' name="classnames">
<!--                                 <option value="">Select a class</option>-->
                                 <?php if(isset($this->classes)){foreach($this->classes as $key=>$classname){ 
                                   if($this->user->classId==$key){?>
                                 <option value="<?php echo $key;?>" selected="selected"><?php echo $classname;?></option>
                                 <?php }else{?>
                                 <option value="<?php echo $key;?>"><?php echo $classname;?></option>
                                 <?php }}}?>
                              </select>
                              <span style="display:none"  id="loadImageclass" href="javascript:void(0);"><img  src="<?php echo $this->basePath() ?>/images/loader16.gif" /></span> 
                              <p class="errorfrm1" id="errorclassname">&nbsp;</p>
                           </div>
                        </div>
                        <div class="form-container">
                           <div class="left-content-label">School Name</div>
                           <div class="inputText">
                               <input type="text" onkeypress="updateKeypress(event)" id="userschool" placeholder="Enter your school name" name="userschool"  value="<?php if(isset($this->user->school_name)){echo urldecode($this->user->school_name);}?>"/>
                              <p class="errorfrm1" id="errorschool">&nbsp;</p>
                           </div>
                        </div>
                        <?php } ?>
                        <div class="form-container">
                           <div class="left-content-label">Postal Code</div>
                           <div class="inputText">
                              <input type="text" onkeypress="updateKeypress(event);return isNumberKey(event);" id="postalcode" name="postalcode"  maxlength="6" value="<?php if(isset($this->user->postalcode)){echo $this->user->postalcode;}?>"/>
                              <p class="errorfrm1" id="errorpostalcode">&nbsp;</p>
                           </div>
                        </div>
                        <div class="form-container">
                           <div class="left-content-label">User Location<span class="staricon">*</span></div>
                           <div class="inputText_right">
                              <p class="dropdown1">
                                 <select id="ucountries" class='custom-select_loc' name="ucountries">
                                    <option value="">Country</option>
                                    <?php if(isset($this->countries)){foreach($this->countries as $countryname){?>
                                    <?php if($this->countaryid == $countryname->getcountryid()){?>
                                    <option value="<?php echo $countryname->getcountryid();?>" selected="selected"><?php echo $countryname->getcountryname();?></option>
                                    <?php }else{?>
                                    <option value="<?php echo $countryname->getcountryid();?>"><?php echo $countryname->getcountryname();?></option>
                                    <?php }}}?>
                                 </select>
                              </p>
                              <p id="statesss">
                                 <select class='custom-select_state' id="states" name="states" >
                                    <option value="">State</option>
                                    <?php if(isset($this->states) && count($this->countries)>0 ){foreach($this->states as $statenames){  ?>
                                    <?php if($this->stateid == $statenames->getstateId()){?>
                                    <option value="<?php echo $statenames->getstateId();?>" selected="selected"><?php echo $statenames->getstatename();?></option>
                                    <?php }else{?>
                                    <option value="<?php echo $statenames->getstateId();?>"><?php echo $statenames->getstatename();?></option>
                                    <?php }}}?>
                                 </select>
                              </p>
                              <p class="errorfrm1" id="errorcountry">&nbsp;</p>
                              <p class="errorfrm1" id="errorstate">&nbsp;</p>
                           </div>
                        </div>
                        <div class="form-container">
                           <div class="left-content-label">City name</div>
                           <div class="inputText">
                              <input type="text" placeholder="Enter your city name" onkeypress="updateKeypress(event)" id="other_city" name="other_city"  value="<?php if(isset($this->cityValue)){echo $this->cityValue;}?>"/>
                              <p class="errorfrm1" id="errorothercity">&nbsp;</p>
                           </div>
                           <div class="dropdown1">
                           </div>
                        </div>
                         <?php if($this->user->user_type_id == '1'){?>  	
                        <div class="form-container">
                        <div style="display:inline-block; margin-left:20px;">
                         <p class=" " style="display:inline-block"> <input type="checkbox" name="allowschedule" value="1" <?php if($this->user->allowschedule == '1') echo "checked";else echo ""; ?> style="display:inline-block"> Allow parent/mentor to manage schedule</p></div>
                          </div>
                       <?php } ?>
                        <div class="button-container">
                           <input type="button" value="" onclick="updateuserProfile()" id="updateuserprofile" name="updateuserprofile" class="btn-save"/>
                           <div class="btn-space">&nbsp;</div>
                           <input type="button" onclick="location.href = '<?php echo $this->Url('zfcuser/myprofile') ?>';" value="" class="btn-cancel"/></a>
                           <input type="hidden" id="hiduserid" name="hiduserid" value="<?php if($this->zfcUserIdentity()->getId()){ echo $this->zfcUserIdentity()->getId();}?>">
                           <input type="hidden" id="useremail" name="useremail" value="<?php if($this->zfcUserIdentity()->getEmail()) {echo $this->zfcUserIdentity()->getEmail();}?>"/>
                        </div>
                        <div class="extra-space">&nbsp;</div>
                     </form>
                  </div>
               </td>
            </tr>
         </tbody>
      </table>
   </div>
</div>
<?php }else{?>
<script>
   window.location="<?php echo $this->url('home');?>"
</script>
<?php }?>
<script type='text/javascript'>//<![CDATA[
   $(window).load(function(){
   $('.custom-upload input[type=file]').change(function(){
      $(this).next().find('input').val($(this).val());
   });
   });//]]> 
   
</script>
<script type="text/javascript" language="JavaScript">
   $( document ).ready(function() {
       document.forms['updateprofile'].elements['username'].focus();
   });
</script>
<script type="text/javascript">
   $("#dropdown_flag_customsd select").msDropDown();
   var a=$("#nav_find").val();
   $(document).ready(function(){
   $("#profile").height($(".right-content").height()+8);
   });
   $(window).resize(function(){
   $("#profile").height($(".right-content").height()+8);
   });
   
   $(document).ready(function() {
   $('#image_file').bind('change', function() {
   	if(this.files[0].size > 1000141){
   		$("#fileerror").val(1);
   		alert("Image size should be below 1 mb");
   		return false;
   	}
   	else
   	{
   		$("#fileerror").val(0);
   	}
   });
   });
   function updateKeypress(e){
       if(e.keyCode == 13){
            updateuserProfile();
       }
   }
   
   function isNumberKey(evt) {
        var charCode = (evt.which) ? evt.which : event.keyCode
        if (charCode > 31 && (charCode < 48 || charCode > 57))
            return false;
        return true;
    }

   function updateuserProfile(){ 
   	var letters = /^[a-zA-Z ]*$/; 
   	var numbers = /^[0-9]+$/;
   	var uphonenumber=$("#phonenumber").val();
   	var ucityname=$("#other_city").val();
          var uname=$("#username").val();
   	var postalcode=$("#postalcode").val();	
   	var uschool=$("#userschool").val();		
   	var flag=true;
   	
   	if($('#image_file').val()!=""){
   		var val = $('#image_file').val();
   		switch(val.substring(val.lastIndexOf('.') + 1).toLowerCase()){
   			case 'gif': case 'jpg': case 'png': case 'jpeg':
   				$('#errorimage1').html('');
   				break;
   			default:
   				$(this).val('');
   				$('#errorimage1').html('Please upload jpg/png/gif/jpeg formats');
   				$('#image_file').focus();
   				flag=false;
   				return false;
   		}
   	}
   	if($("#fileerror").val()==1)
   	{
   		$("#errorimage").html("Image size should be below 1 mb");
   		$('#image_file').focus();
   		flag=false;
   	}
   	else
   	{
   			$("#errorimage").html('');
   	}		
   	if(uname==""){
   		$("#errorname").html("Please enter your name");
   		$("#username").focus();
   		flag=false;
   	}else if(!uname.match(letters)){
   		$("#errorname").html("Please enter only alphabets");
   		flag=false;
   	}else{
   		$("#errorname").html("");
   	}
   	
   	if ( ( updateprofile.sex[0].checked == false ) && ( updateprofile.sex[1].checked == false ) )
   	{
   		$("#errorgender").html("Please select your Gender" );
   		
   		flag=false;
   	}else{
   		$("#errorgender").html("");
   	}		
   	if($("#usertype").val()=="0"){
   		$("#errorusertype").html("Please select your usertype");
   		$("#usertype").focus()
   		flag=false;
   	}else{
   		$("#errorusertype").html("");
   	}
   	 if(uphonenumber!="" && !uphonenumber.match(numbers)){
   		$("#errorphonenumber").html("Please enter only numbers");
   		$("#phonenumber").focus();
   		flag=false;
   	}else if(uphonenumber.match(numbers)){
                      var a = uphonenumber.split(" ").join(""); 
                      var filter = /^[0-9-,+]+$/;
                      if (filter.test(a)) {
                          var maxRange = 10;
                          if($("#phonecode").val() == "+971"){
                              var maxRange = 9;
                          }
                          
                          if(a.length != maxRange){
                              $("#errorphonenumber").html("Please enter a valid mobile number");
                              $("#phonenumber").focus();
                              flag=false;
                          }else{
                              $("#errorphonenumber").html("");
                          }
                      }
                  }else{
   		$("#errorphonenumber").html("");
   	}
   	if($("#board").val()=="0"){
   		$("#errorboard").html("Please select your Board.");
   		$("#board").focus()
   		flag=false;
   	}else{
   		$("#errorboard").html("");
   	}
   	if($("#classnames").val()==""){
   		$("#errorclassname").html("Please select your Class.");
   		$("#classnames").focus()
   		flag=false;
   	}else{
   		$("#errorclassname").html("");
   	}
   
   	if($("#ucountries").val()=="" || $("#states").val()=="") {			
   		$("#errorcountry").html("Please select the Country and State.");
   		$("#ucountries").focus()
   		flag=false;
   	}else{
   		$("#errorcountry").html("");
   	}
   	if(ucityname!=""){
   		if(!ucityname.match(letters)){
   			$("#errorothercity").html("Please enter only alphabets.");
   			$("#other_city").focus();
   			flag=false;
   		}else{
   			$("#errorothercity").html("");			
   		}
   	}
   	if(flag==false){
   	$("#starerr").html("All (*) fields are mandatory ");
   		$('html, body , div .right-content').animate({scrollTop: 0}, 300);
   		return false;
   	}else{
   		$("#updateprofile").submit();
   	}
   }
   $(document).ready(function(){ 
      $("#ucountries").change(function(){
        $("#states").val('');
   	$("#states").parent().find(".holder_state").text("");
   	$("#states").parent().find(".holder_state").text("Select a state");
   	var countryid=$("#ucountries").val();		
   	$.ajax({
   		type:	'POST',
   		url:   	BASE_URL+'/user/getstates',
   		data:	{countryid:countryid},
   		success: function(data){ 						
   			$("#states").html(data.statenames);							
   		}
   	});	
   });
   
  
 /* $("#board").change(function(){ 
   	$("#classnames").parent().find(".holder_iam").text("");
   	$("#classnames").parent().find(".holder_iam").text("Select a class");
   	var board=$("#board").val();
   	$('#loadImageclass').show();		
   	$.ajax({
   		type:	'POST',
   		url:   	BASE_URL+'/account/getclass',
   		data:	{board_id:board},
   		success: function(data){
   			$('#loadImageclass').hide();	
   			if(data.output=='success'){					
   				$("#classnames").html(data.classes);
   			}							
   		}
   	});
   }); */

   $("#board").change(function() {
        
        var optionString = '<option value="">Select Class</option>';
        $("#classnames").html(optionString);
        if($(this).val()){
            $('#loadImageclass').show();
            $.ajax({type: 'POST',
                url: BASE_URL + "/lms/index/containerlist/"+$(this).val(),
                dataType: 'json',
                success: function(data) {
                   $('#loadImageclass').hide();
                   var optionString = '<option value="">Select Class</option>';
                   $("#classnames").html(optionString);
                   $.each(data.options, function(key, obj)
                   {
                        optionString += '<option value="'+obj.rack_id+'">'+obj.rack_name+'</option>';

                   })
                   $("#classnames").html(optionString);

                }
            });
      }else{
        $("#classnames").parent().find(".holder_iam").text("");
   	$("#classnames").parent().find(".holder_iam").text("Select class");
      }
        

    });
   
   
   
   $("#states").change(function(){ 		
   	var stateid=$("#states").val();
   	var countryid=$("#ucountries").val();		
   	$.ajax({
   		type:	'POST',
   		url:   		BASE_URL+'/user/getcities',
   		data:	{countryid:countryid,stateid:stateid},
   		success: function(data){
   			if(data.output=='success'){ 				
   				$("#cities").html(data.citynames);
   			}							
   		}
   	});
   });
   });
   function getallcities(){ }	
</script>